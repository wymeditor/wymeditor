/*!
WYMeditor - v1.0.0-b6 - 03/02/2014

Home page: http://wymeditor.github.io/wymeditor/

Copyright (c) 2014 Jean-Francois Hovinne;
Licensed MIT, GPLv2
*/

if("undefined"==typeof WYMeditor)var WYMeditor={};!function(){if("undefined"==typeof window.console&&"undefined"==typeof console){var a,b=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"],c=function(){};for(WYMeditor.console={},a=0;a<b.length;a+=1)WYMeditor.console[b[a]]=c}else"undefined"!=typeof console?WYMeditor.console=console:window.console.firebug?WYMeditor.console=window.console:window.console&&(WYMeditor.console=window.console)}(),jQuery.extend(WYMeditor,{VERSION:"1.0.0-b6",INSTANCES:[],STRINGS:[],SKINS:[],NAME:"name",INDEX:"{Wym_Index}",WYM_INDEX:"wym_index",BASE_PATH:"{Wym_Base_Path}",CSS_PATH:"{Wym_Css_Path}",WYM_PATH:"{Wym_Wym_Path}",SKINS_DEFAULT_PATH:"skins/",SKINS_DEFAULT_CSS:"skin.css",SKINS_DEFAULT_JS:"skin.js",LANG_DEFAULT_PATH:"lang/",IFRAME_BASE_PATH:"{Wym_Iframe_Base_Path}",IFRAME_DEFAULT:"iframe/default/",JQUERY_PATH:"{Wym_Jquery_Path}",DIRECTION:"{Wym_Direction}",LOGO:"{Wym_Logo}",TOOLS:"{Wym_Tools}",TOOLS_ITEMS:"{Wym_Tools_Items}",TOOL_NAME:"{Wym_Tool_Name}",TOOL_TITLE:"{Wym_Tool_Title}",TOOL_CLASS:"{Wym_Tool_Class}",CLASSES:"{Wym_Classes}",CLASSES_ITEMS:"{Wym_Classes_Items}",CLASS_NAME:"{Wym_Class_Name}",CLASS_TITLE:"{Wym_Class_Title}",CONTAINERS:"{Wym_Containers}",CONTAINERS_ITEMS:"{Wym_Containers_Items}",CONTAINER_NAME:"{Wym_Container_Name}",CONTAINER_TITLE:"{Wym_Containers_Title}",CONTAINER_CLASS:"{Wym_Container_Class}",HTML:"{Wym_Html}",IFRAME:"{Wym_Iframe}",STATUS:"{Wym_Status}",DIALOG_TITLE:"{Wym_Dialog_Title}",DIALOG_BODY:"{Wym_Dialog_Body}",NEWLINE:"\n",STRING:"string",BODY:"body",DIV:"div",P:"p",H1:"h1",H2:"h2",H3:"h3",H4:"h4",H5:"h5",H6:"h6",PRE:"pre",BLOCKQUOTE:"blockquote",A:"a",BR:"br",IMG:"img",TABLE:"table",TR:"tr",TD:"td",TH:"th",UL:"ul",OL:"ol",LI:"li",CLASS:"class",HREF:"href",SRC:"src",TITLE:"title",REL:"rel",ALT:"alt",DIALOG_LINK:"Link",DIALOG_IMAGE:"Image",DIALOG_TABLE:"Table",DIALOG_PASTE:"Paste_From_Word",BOLD:"Bold",ITALIC:"Italic",CREATE_LINK:"CreateLink",INSERT_IMAGE:"InsertImage",INSERT_TABLE:"InsertTable",INSERT_HTML:"InsertHTML",PASTE:"Paste",INDENT:"Indent",OUTDENT:"Outdent",TOGGLE_HTML:"ToggleHtml",FORMAT_BLOCK:"FormatBlock",PREVIEW:"Preview",UNLINK:"Unlink",INSERT_UNORDEREDLIST:"InsertUnorderedList",INSERT_ORDEREDLIST:"InsertOrderedList",MAIN_CONTAINERS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote"],FORBIDDEN_MAIN_CONTAINERS:["strong","b","em","i","sub","sup","a","span"],BLOCKS:["address","blockquote","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","noscript","ol","p","pre","table","ul","dd","dt","li","tbody","td","tfoot","th","thead","tr"],BLOCKING_ELEMENTS:["table","blockquote","pre"],NON_BLOCKING_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6"],LIST_TYPE_ELEMENTS:["ul","ol"],HEADING_ELEMENTS:["h1","h2","h3","h4","h5","h6"],POTENTIAL_LIST_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","td"],POTENTIAL_TABLE_INSERT_ELEMENTS:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","li"],INLINE_TABLE_INSERTION_ELEMENTS:["li"],SELECTABLE_TABLE_ELEMENTS:["td","th","caption"],BLOCKING_ELEMENT_SPACER_CLASS:"wym-blocking-element-spacer",EDITOR_ONLY_CLASS:"wym-editor-only",CLASSES_REMOVED_BY_PARSER:["apple-style-span"],KEY:{BACKSPACE:8,TAB:9,ENTER:13,CTRL:17,END:35,HOME:36,CURSOR:[37,38,39,40],LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,B:66,I:73,R:82,COMMAND:224},POTENTIAL_BLOCK_ELEMENT_CREATION_KEYS:[8,13,37,38,39,40,46],EVENTS:{postIframeInitialization:"wym-postIframeInitialization",postBlockMaybeCreated:"wym-postBlockMaybeCreated"},NODE:{ELEMENT:1,ATTRIBUTE:2,TEXT:3},editor:function(a,b){this._index=WYMeditor.INSTANCES.push(this)-1,this._element=a,this._options=b,this._options.html||(this._options.html=jQuery(a).val()),this._options.wymPath=this._options.wymPath||WYMeditor.computeWymPath(),this._options.basePath=this._options.basePath||WYMeditor.computeBasePath(this._options.wymPath),this._options.jQueryPath=this._options.jQueryPath||WYMeditor.computeJqueryPath(),this._options.skinPath=this._options.skinPath||["",this._options.basePath,WYMeditor.SKINS_DEFAULT_PATH,this._options.skin,"/"].join(""),this._options.langPath=this._options.langPath||this._options.basePath+WYMeditor.LANG_DEFAULT_PATH,this._options.iframeBasePath=this._options.iframeBasePath||this._options.basePath+WYMeditor.IFRAME_DEFAULT,this.init()}}),jQuery.fn.wymeditor=function(a){return a=jQuery.extend({html:"",basePath:!1,skinPath:!1,wymPath:!1,iframeBasePath:!1,jQueryPath:!1,styles:!1,stylesheet:!1,skin:"default",initSkin:!0,loadSkin:!0,lang:"en",direction:"ltr",customCommands:[],structureRules:{defaultRootContainer:"p"},boxHtml:String()+"<div class='wym_box'><div class='wym_area_top'>"+WYMeditor.TOOLS+"</div><div class='wym_area_left'></div><div class='wym_area_right'>"+WYMeditor.CONTAINERS+WYMeditor.CLASSES+"</div><div class='wym_area_main'>"+WYMeditor.HTML+WYMeditor.IFRAME+WYMeditor.STATUS+"</div><div class='wym_area_bottom'>"+WYMeditor.LOGO+"</div></div>",logoHtml:String()+'<a class="wym_wymeditor_link" href="http://www.wymeditor.org/">WYMeditor</a>',iframeHtml:String()+'<div class="wym_iframe wym_section"><iframe src="'+WYMeditor.IFRAME_BASE_PATH+'wymiframe.html" onload="this.contentWindow.parent.WYMeditor.INSTANCES['+WYMeditor.INDEX+'].initIframe(this)"></iframe></div>',editorStyles:[],toolsHtml:String()+'<div class="wym_tools wym_section"><h2>{Tools}</h2><ul>'+WYMeditor.TOOLS_ITEMS+"</ul></div>",toolsItemHtml:String()+'<li class="'+WYMeditor.TOOL_CLASS+'"><a href="#" name="'+WYMeditor.TOOL_NAME+'" title="'+WYMeditor.TOOL_TITLE+'">'+WYMeditor.TOOL_TITLE+"</a></li>",toolsItems:[{name:"Bold",title:"Strong",css:"wym_tools_strong"},{name:"Italic",title:"Emphasis",css:"wym_tools_emphasis"},{name:"Superscript",title:"Superscript",css:"wym_tools_superscript"},{name:"Subscript",title:"Subscript",css:"wym_tools_subscript"},{name:"InsertOrderedList",title:"Ordered_List",css:"wym_tools_ordered_list"},{name:"InsertUnorderedList",title:"Unordered_List",css:"wym_tools_unordered_list"},{name:"Indent",title:"Indent",css:"wym_tools_indent"},{name:"Outdent",title:"Outdent",css:"wym_tools_outdent"},{name:"Undo",title:"Undo",css:"wym_tools_undo"},{name:"Redo",title:"Redo",css:"wym_tools_redo"},{name:"CreateLink",title:"Link",css:"wym_tools_link"},{name:"Unlink",title:"Unlink",css:"wym_tools_unlink"},{name:"InsertImage",title:"Image",css:"wym_tools_image"},{name:"InsertTable",title:"Table",css:"wym_tools_table"},{name:"Paste",title:"Paste_From_Word",css:"wym_tools_paste"},{name:"ToggleHtml",title:"HTML",css:"wym_tools_html"},{name:"Preview",title:"Preview",css:"wym_tools_preview"}],containersHtml:String()+'<div class="wym_containers wym_section"><h2>{Containers}</h2><ul>'+WYMeditor.CONTAINERS_ITEMS+"</ul></div>",containersItemHtml:String()+'<li class="'+WYMeditor.CONTAINER_CLASS+'"><a href="#" name="'+WYMeditor.CONTAINER_NAME+'">'+WYMeditor.CONTAINER_TITLE+"</a></li>",containersItems:[{name:"P",title:"Paragraph",css:"wym_containers_p"},{name:"H1",title:"Heading_1",css:"wym_containers_h1"},{name:"H2",title:"Heading_2",css:"wym_containers_h2"},{name:"H3",title:"Heading_3",css:"wym_containers_h3"},{name:"H4",title:"Heading_4",css:"wym_containers_h4"},{name:"H5",title:"Heading_5",css:"wym_containers_h5"},{name:"H6",title:"Heading_6",css:"wym_containers_h6"},{name:"PRE",title:"Preformatted",css:"wym_containers_pre"},{name:"BLOCKQUOTE",title:"Blockquote",css:"wym_containers_blockquote"},{name:"TH",title:"Table_Header",css:"wym_containers_th"}],classesHtml:String()+'<div class="wym_classes wym_section"><h2>{Classes}</h2><ul>'+WYMeditor.CLASSES_ITEMS+"</ul></div>",classesItemHtml:String()+'<li class="wym_classes_'+WYMeditor.CLASS_NAME+'"><a href="#" name="'+WYMeditor.CLASS_NAME+'">'+WYMeditor.CLASS_TITLE+"</a></li>",classesItems:[],statusHtml:String()+'<div class="wym_status wym_section"><h2>{Status}</h2></div>',htmlHtml:String()+'<div class="wym_html wym_section"><h2>{Source_Code}</h2><textarea class="wym_html_val"></textarea></div>',boxSelector:".wym_box",toolsSelector:".wym_tools",toolsListSelector:" ul",containersSelector:".wym_containers",classesSelector:".wym_classes",htmlSelector:".wym_html",iframeSelector:".wym_iframe iframe",iframeBodySelector:".wym_iframe",statusSelector:".wym_status",toolSelector:".wym_tools a",containerSelector:".wym_containers a",classSelector:".wym_classes a",htmlValSelector:".wym_html_val",hrefSelector:".wym_href",srcSelector:".wym_src",titleSelector:".wym_title",relSelector:".wym_rel",altSelector:".wym_alt",textSelector:".wym_text",rowsSelector:".wym_rows",colsSelector:".wym_cols",captionSelector:".wym_caption",summarySelector:".wym_summary",submitSelector:"form",cancelSelector:".wym_cancel",previewSelector:"",dialogTypeSelector:".wym_dialog_type",dialogLinkSelector:".wym_dialog_link",dialogImageSelector:".wym_dialog_image",dialogTableSelector:".wym_dialog_table",dialogPasteSelector:".wym_dialog_paste",dialogPreviewSelector:".wym_dialog_preview",updateSelector:".wymupdate",updateEvent:"click",dialogFeatures:"menubar=no,titlebar=no,toolbar=no,resizable=no,width=560,height=300,top=0,left=0",dialogFeaturesPreview:"menubar=no,titlebar=no,toolbar=no,resizable=no,scrollbars=yes,width=560,height=300,top=0,left=0",dialogHtml:String()+'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html dir="'+WYMeditor.DIRECTION+'"><head><link rel="stylesheet" type="text/css" media="screen" href="'+WYMeditor.CSS_PATH+'" /><title>'+WYMeditor.DIALOG_TITLE+'</title><script type="text/javascript" src="'+WYMeditor.JQUERY_PATH+'"></script><script type="text/javascript" src="'+WYMeditor.WYM_PATH+'"></script></head>'+WYMeditor.DIALOG_BODY+"</html>",dialogLinkHtml:String()+'<body class="wym_dialog wym_dialog_link"  onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_LINK+'" /><legend>{Link}</legend><div class="row"><label>{URL}</label><input type="text" class="wym_href" value="" size="40" autofocus="autofocus" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row"><label>{Relationship}</label><input type="text" class="wym_rel" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',dialogImageHtml:String()+'<body class="wym_dialog wym_dialog_image" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_IMAGE+'" /><legend>{Image}</legend><div class="row"><label>{URL}</label><input type="text" class="wym_src" value="" size="40" autofocus="autofocus" /></div><div class="row"><label>{Alternative_Text}</label><input type="text" class="wym_alt" value="" size="40" /></div><div class="row"><label>{Title}</label><input type="text" class="wym_title" value="" size="40" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',dialogTableHtml:String()+'<body class="wym_dialog wym_dialog_table" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><fieldset><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_TABLE+'" /><legend>{Table}</legend><div class="row"><label>{Caption}</label><input type="text" class="wym_caption" value="" size="40" /></div><div class="row"><label>{Summary}</label><input type="text" class="wym_summary" value="" size="40" /></div><div class="row"><label>{Number_Of_Rows}</label><input type="text" class="wym_rows" value="3" size="3" /></div><div class="row"><label>{Number_Of_Cols}</label><input type="text" class="wym_cols" value="2" size="3" /></div><div class="row row-indent"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',dialogPasteHtml:String()+'<body class="wym_dialog wym_dialog_paste" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"><form><input type="hidden" class="wym_dialog_type" value="'+WYMeditor.DIALOG_PASTE+'" /><fieldset><legend>{Paste_From_Word}</legend><div class="row"><textarea class="wym_text" rows="10" cols="50" autofocus="autofocus"></textarea></div><div class="row"><input class="wym_submit" type="submit" value="{Submit}" /><input class="wym_cancel" type="button" value="{Cancel}" /></div></fieldset></form></body>',dialogPreviewHtml:String()+'<body class="wym_dialog wym_dialog_preview" onload="WYMeditor.INIT_DIALOG('+WYMeditor.INDEX+')"></body>',dialogStyles:[],stringDelimiterLeft:"{",stringDelimiterRight:"}",preInit:null,preBind:null,postInit:null,preInitDialog:null,postInitDialog:null},a),this.each(function(){this._wym=new WYMeditor.editor(jQuery(this),a)})},jQuery.extend({wymeditors:function(a){return WYMeditor.INSTANCES[a]}}),WYMeditor.computeWymPath=function(){var a=jQuery(jQuery.grep(jQuery("script"),function(a){return a.src?a.src.match(/jquery\.wymeditor(\.pack|\.min|\.packed)?\.js(\?.*)?$/)||a.src.match(/\/core\.js(\?.*)?$/):null}));return a.length>0?a.attr("src"):(WYMeditor.console.warn("Error determining wymPath. No base WYMeditor file located."),WYMeditor.console.warn("Assuming wymPath to be the current URL"),WYMeditor.console.warn("Please pass a correct wymPath option"),"")},WYMeditor.computeBasePath=function(a){var b=a.lastIndexOf("/");return a.substr(0,b+1)},WYMeditor.computeJqueryPath=function(){return jQuery(jQuery.grep(jQuery("script"),function(a){return a.src&&a.src.match(/jquery(-(.*)){0,1}(\.pack|\.min|\.packed)?\.js(\?.*)?$/)})).attr("src")},WYMeditor.INIT_DIALOG=function(index){var wym=window.opener.WYMeditor.INSTANCES[index],doc=window.document,selected=wym.selected(),dialogType=jQuery(wym._options.dialogTypeSelector).val(),sStamp=wym.uniqueStamp(),styles,aCss,tableOnClick;dialogType===WYMeditor.DIALOG_LINK&&(selected&&selected.tagName&&selected.tagName.toLowerCase!==WYMeditor.A&&(selected=jQuery(selected).parentsOrSelf(WYMeditor.A)),!selected&&wym._selectedImage&&(selected=jQuery(wym._selectedImage).parentsOrSelf(WYMeditor.A))),jQuery.isFunction(wym._options.preInitDialog)&&wym._options.preInitDialog(wym,window),styles=doc.styleSheets[0],aCss=eval(wym._options.dialogStyles),wym.addCssRules(doc,aCss),selected&&(jQuery(wym._options.hrefSelector).val(jQuery(selected).attr(WYMeditor.HREF)),jQuery(wym._options.srcSelector).val(jQuery(selected).attr(WYMeditor.SRC)),jQuery(wym._options.titleSelector).val(jQuery(selected).attr(WYMeditor.TITLE)),jQuery(wym._options.relSelector).val(jQuery(selected).attr(WYMeditor.REL)),jQuery(wym._options.altSelector).val(jQuery(selected).attr(WYMeditor.ALT))),wym._selectedImage&&(jQuery(wym._options.dialogImageSelector+" "+wym._options.srcSelector).val(jQuery(wym._selectedImage).attr(WYMeditor.SRC)),jQuery(wym._options.dialogImageSelector+" "+wym._options.titleSelector).val(jQuery(wym._selectedImage).attr(WYMeditor.TITLE)),jQuery(wym._options.dialogImageSelector+" "+wym._options.altSelector).val(jQuery(wym._selectedImage).attr(WYMeditor.ALT))),jQuery(wym._options.dialogLinkSelector+" "+wym._options.submitSelector).submit(function(){var a,b=jQuery(wym._options.hrefSelector).val();b.length>0&&(selected[0]&&selected[0].tagName.toLowerCase()===WYMeditor.A?a=selected:(wym._exec(WYMeditor.CREATE_LINK,sStamp),a=jQuery("a[href="+sStamp+"]",wym._doc.body)),a.attr(WYMeditor.HREF,b),a.attr(WYMeditor.TITLE,jQuery(wym._options.titleSelector).val()),a.attr(WYMeditor.REL,jQuery(wym._options.relSelector).val())),window.close()}),jQuery(wym._options.dialogImageSelector+" "+wym._options.submitSelector).submit(function(){var a,b=jQuery(wym._options.srcSelector).val();b.length>0&&(wym._exec(WYMeditor.INSERT_IMAGE,sStamp),a=jQuery("img[src$="+sStamp+"]",wym._doc.body),a.attr(WYMeditor.SRC,b),a.attr(WYMeditor.TITLE,jQuery(wym._options.titleSelector).val()),a.attr(WYMeditor.ALT,jQuery(wym._options.altSelector).val())),window.close()}),tableOnClick=WYMeditor.MAKE_TABLE_ONCLICK(wym),jQuery(wym._options.dialogTableSelector+" "+wym._options.submitSelector).submit(tableOnClick),jQuery(wym._options.dialogPasteSelector+" "+wym._options.submitSelector).submit(function(){var a=jQuery(wym._options.textSelector).val();wym.paste(a),window.close()}),jQuery(wym._options.dialogPreviewSelector+" "+wym._options.previewSelector).html(wym.xhtml()),jQuery(wym._options.cancelSelector).mousedown(function(){window.close()}),jQuery.isFunction(wym._options.postInitDialog)&&wym._options.postInitDialog(wym,window)},WYMeditor.MAKE_TABLE_ONCLICK=function(a){var b=function(){var b=jQuery(a._options.rowsSelector).val(),c=jQuery(a._options.colsSelector).val(),d=jQuery(a._options.captionSelector).val(),e=jQuery(a._options.summarySelector).val();a.insertTable(b,c,d,e),window.close()};return b},jQuery.fn.isPhantomNode=function(){return 3===this[0].nodeType?!/[^\t\n\r ]/.test(this[0].data):!1},jQuery.fn.nextContentsUntil=function(a,b){var c,d=[],e=this.get(0);if(a=a?a:"",b=b?b:"",!e)return jQuery();for(e=e.nextSibling;e&&!jQuery(e).is(a);)d.push(e),e=e.nextSibling;return c=jQuery(d),b?c.filter(b):c},jQuery.fn.nextAllContents=function(){return jQuery(this).nextContentsUntil("","")},jQuery.fn.prevContentsUntil=function(a,b){var c,d=[],e=this.get(0);if(a=a?a:"",b=b?b:"",!e)return jQuery();for(e=e.previousSibling;e&&!jQuery(e).is(a);)d.push(e),e=e.previousSibling;return c=jQuery(d),b?c.filter(b):c},jQuery.fn.prevAllContents=function(){return jQuery(this).prevContentsUntil("","")},WYMeditor.isPhantomNode=function(a){return 3===a.nodeType?!/[^\t\n\r ]/.test(a.data):!1},WYMeditor.isPhantomString=function(a){return!/[^\t\n\r ]/.test(a)},jQuery.fn.parentsOrSelf=function(a){var b=this;return 3===b[0].nodeType&&(b=b.parents().slice(0,1)),1===b.filter(a).size()?b:b.parents(a).slice(0,1)},WYMeditor.changeNodeType=function(a,b){var c,d,e=a.attributes;for(jQuery(a).wrapInner("<"+b+">"),c=jQuery(a).children().get(0),d=0;d<e.length;d++)e[d].specified&&c.setAttribute(e[d].nodeName,e[d].nodeValue);return jQuery(a).contents().unwrap(),c},WYMeditor.Helper={replaceAll:function(a,b,c){var d=new RegExp(b,"g");return a.replace(d,c)},insertAt:function(a,b,c){return a.substr(0,c)+b+a.substring(c)},trim:function(a){return a.replace(/^(\s*)|(\s*)$/gm,"")},contains:function(a,b){var c;for(c=0;c<a.length;c+=1)if(a[c]===b)return!0;return!1},indexOf:function(a,b){var c,d=-1;for(c=0;c<a.length;c+=1)if(a[c]===b){d=c;break}return d},findByName:function(a,b){var c,d;for(c=0;c<a.length;c+=1)if(d=a[c],d.name===b)return d;return null}},WYMeditor.editor.prototype.init=function(){var WymClass=!1,SaxListener,prop,h,iframeHtml,boxHtml,aTools,sTools,oTool,sTool,i,aClasses,sClasses,oClass,sClass,aContainers,sContainers,sContainer,oContainer;if(jQuery.browser.msie?WymClass=new WYMeditor.WymClassExplorer(this):jQuery.browser.mozilla?WymClass=new WYMeditor.WymClassMozilla(this):jQuery.browser.opera?WymClass=new WYMeditor.WymClassOpera(this):(jQuery.browser.safari||jQuery.browser.webkit||jQuery.browser.chrome)&&(WymClass=new WYMeditor.WymClassSafari(this)),WymClass!==!1){jQuery.isFunction(this._options.preInit)&&this._options.preInit(this),this.parser=null,this.helper=null,SaxListener=new WYMeditor.XhtmlSaxListener,this.parser=new WYMeditor.XhtmlParser(SaxListener),(this._options.styles||this._options.stylesheet)&&this.configureEditorUsingRawCss(),this.helper=new WYMeditor.XmlHelper;for(prop in WymClass)this[prop]=WymClass[prop];for(this._box=jQuery(this._element).hide().after(this._options.boxHtml).next().addClass("wym_box_"+this._index),jQuery.isFunction(jQuery.fn.data)&&(jQuery.data(this._box.get(0),WYMeditor.WYM_INDEX,this._index),jQuery.data(this._element.get(0),WYMeditor.WYM_INDEX,this._index)),h=WYMeditor.Helper,iframeHtml=this._options.iframeHtml,iframeHtml=h.replaceAll(iframeHtml,WYMeditor.INDEX,this._index),iframeHtml=h.replaceAll(iframeHtml,WYMeditor.IFRAME_BASE_PATH,this._options.iframeBasePath),boxHtml=jQuery(this._box).html(),boxHtml=h.replaceAll(boxHtml,WYMeditor.LOGO,this._options.logoHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS,this._options.toolsHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS,this._options.containersHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES,this._options.classesHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.HTML,this._options.htmlHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.IFRAME,iframeHtml),boxHtml=h.replaceAll(boxHtml,WYMeditor.STATUS,this._options.statusHtml),aTools=eval(this._options.toolsItems),sTools="",i=0;i<aTools.length;i+=1)oTool=aTools[i],sTool="",oTool.name&&oTool.title&&(sTool=this._options.toolsItemHtml),sTool=h.replaceAll(sTool,WYMeditor.TOOL_NAME,oTool.name),sTool=h.replaceAll(sTool,WYMeditor.TOOL_TITLE,this._options.stringDelimiterLeft+oTool.title+this._options.stringDelimiterRight),sTool=h.replaceAll(sTool,WYMeditor.TOOL_CLASS,oTool.css),sTools+=sTool;for(boxHtml=h.replaceAll(boxHtml,WYMeditor.TOOLS_ITEMS,sTools),aClasses=eval(this._options.classesItems),sClasses="",i=0;i<aClasses.length;i+=1)oClass=aClasses[i],sClass="",oClass.name&&oClass.title&&(sClass=this._options.classesItemHtml),sClass=h.replaceAll(sClass,WYMeditor.CLASS_NAME,oClass.name),sClass=h.replaceAll(sClass,WYMeditor.CLASS_TITLE,oClass.title),sClasses+=sClass;for(boxHtml=h.replaceAll(boxHtml,WYMeditor.CLASSES_ITEMS,sClasses),aContainers=eval(this._options.containersItems),sContainers="",i=0;i<aContainers.length;i+=1)oContainer=aContainers[i],sContainer="",oContainer.name&&oContainer.title&&(sContainer=this._options.containersItemHtml),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_NAME,oContainer.name),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_TITLE,this._options.stringDelimiterLeft+oContainer.title+this._options.stringDelimiterRight),sContainer=h.replaceAll(sContainer,WYMeditor.CONTAINER_CLASS,oContainer.css),sContainers+=sContainer;boxHtml=h.replaceAll(boxHtml,WYMeditor.CONTAINERS_ITEMS,sContainers),boxHtml=this.replaceStrings(boxHtml),jQuery(this._box).html(boxHtml),jQuery(this._box).find(this._options.htmlSelector).hide(),this.documentStructureManager=new WYMeditor.DocumentStructureManager(this,this._options.structureRules.defaultRootContainer),this.loadSkin()}},WYMeditor.editor.prototype.bindEvents=function(){var wym=this,$html_val;jQuery(this._box).find(this._options.toolSelector).click(function(){return wym._iframe.contentWindow.focus(),wym.exec(jQuery(this).attr(WYMeditor.NAME)),!1}),jQuery(this._box).find(this._options.containerSelector).click(function(){return wym.container(jQuery(this).attr(WYMeditor.NAME)),!1}),$html_val=jQuery(this._box).find(this._options.htmlValSelector),$html_val.keyup(function(){jQuery(wym._doc.body).html(jQuery(this).val())}),$html_val.focus(function(){jQuery(this).toggleClass("hasfocus")}),$html_val.blur(function(){jQuery(this).toggleClass("hasfocus")}),jQuery(this._box).find(this._options.classSelector).click(function(){var aClasses=eval(wym._options.classesItems),sName=jQuery(this).attr(WYMeditor.NAME),oClass=WYMeditor.Helper.findByName(aClasses,sName),jqexpr;return oClass&&(jqexpr=oClass.expr,wym.toggleClass(sName,jqexpr)),wym._iframe.contentWindow.focus(),!1}),jQuery(this._options.updateSelector).bind(this._options.updateEvent,function(){wym.update()})},WYMeditor.editor.prototype.ready=function(){return null!==this._doc},WYMeditor.editor.prototype.box=function(){return this._box},WYMeditor.editor.prototype._html=function(a){return"string"!=typeof a?jQuery(this._doc.body).html():(jQuery(this._doc.body).html(a),this.update(),void 0)},WYMeditor.editor.prototype.html=function(a){return WYMeditor.console.warn("The function WYMeditor.editor.html() is deprecated. Use either WYMeditor.editor.xhtml() or WYMeditor.editor._html() instead."),"string"!=typeof a?this._html():(this._html(a),void 0)},WYMeditor.editor.prototype.xhtml=function(){return this.parser.parse(this._html())},WYMeditor.editor.prototype.exec=function(a){var b,c,d=this;switch(a){case WYMeditor.CREATE_LINK:b=this.container(),(b||this._selectedImage)&&this.dialog(WYMeditor.DIALOG_LINK);break;case WYMeditor.INSERT_IMAGE:this.dialog(WYMeditor.DIALOG_IMAGE);break;case WYMeditor.INSERT_TABLE:this.dialog(WYMeditor.DIALOG_TABLE);break;case WYMeditor.PASTE:this.dialog(WYMeditor.DIALOG_PASTE);break;case WYMeditor.TOGGLE_HTML:this.update(),this.toggleHtml();break;case WYMeditor.PREVIEW:this.dialog(WYMeditor.PREVIEW,this._options.dialogFeaturesPreview);break;case WYMeditor.INSERT_ORDEREDLIST:this.insertOrderedlist();break;case WYMeditor.INSERT_UNORDEREDLIST:this.insertUnorderedlist();break;case WYMeditor.INDENT:this.indent();break;case WYMeditor.OUTDENT:this.outdent();break;default:c=!1,jQuery.each(this._options.customCommands,function(){return a===this.name?(c=!0,this.run.apply(d),!1):void 0}),c||this._exec(a)}},WYMeditor.editor.prototype.selection=function(){window.rangy&&!rangy.initialized&&rangy.init();var a=this._iframe,b=rangy.getIframeSelection(a);return b},WYMeditor.editor.prototype.selected=function(){var a,b,c,d=this.selection(),e=d.focusNode;return e?(jQuery.browser.msie&&(b=e.tagName&&"body"===e.tagName.toLowerCase(),c="#text"===e.nodeName,d.isCollapsed&&(b||c)&&(a=this._iframe.contentWindow.document.caretPos,a&&a.parentElement&&(e=a.parentElement()))),"#text"===e.nodeName?e.parentNode:e):null},WYMeditor.editor.prototype.selection_collapsed=function(){var a=this.selection(),b=!1;return jQuery.each(a.getAllRanges(),function(){return this.collapsed?(b=!0,!1):void 0}),b},WYMeditor.editor.prototype.selected_contains=function(a){var b=this.selection(),c=[];return jQuery.each(b.getAllRanges(),function(){jQuery.each(this.getNodes(),function(){jQuery(this).is(a)&&c.push(this)})}),c},WYMeditor.editor.prototype.selected_parents_contains=function(a){var b=jQuery([]),c=jQuery(this.selected());return c.is(a)&&(b=b.add(c)),b=b.add(c.parents(a))},WYMeditor.editor.prototype.container=function(a){if("undefined"==typeof a)return this.selected();var b,c,d,e,f,g,h,i=null;if(a.toLowerCase()===WYMeditor.TH){switch(i=this.container(),i.tagName.toLowerCase()){case WYMeditor.TD:case WYMeditor.TH:break;default:b=[WYMeditor.TD,WYMeditor.TH],i=this.findUp(this.container(),b)}null!==i&&(a=WYMeditor.TD,i.tagName.toLowerCase()===WYMeditor.TD&&(a=WYMeditor.TH),this.switchTo(i,a,!1),this.update())}else if(b=[WYMeditor.P,WYMeditor.DIV,WYMeditor.H1,WYMeditor.H2,WYMeditor.H3,WYMeditor.H4,WYMeditor.H5,WYMeditor.H6,WYMeditor.PRE,WYMeditor.BLOCKQUOTE],i=this.findUp(this.container(),b)){if(a.toLowerCase()===WYMeditor.BLOCKQUOTE)if(d=this.findUp(this.container(),WYMeditor.BLOCKQUOTE),null===d)c=this._doc.createElement(a),i.parentNode.insertBefore(c,i),c.appendChild(i),this.setFocusToNode(c.firstChild);else{for(e=d.childNodes,f=e.length,f>0&&(g=e.item(0)),h=0;f>h;h+=1)d.parentNode.insertBefore(e.item(0),d);d.parentNode.removeChild(d),g&&this.setFocusToNode(g)}else this.switchTo(i,a);this.update()}return!1},WYMeditor.editor.prototype.isForbiddenMainContainer=function(a){return jQuery.inArray(a.toLowerCase(),WYMeditor.FORBIDDEN_MAIN_CONTAINERS)>-1},WYMeditor.editor.prototype.keyCanCreateBlockElement=function(a){return jQuery.inArray(a,WYMeditor.POTENTIAL_BLOCK_ELEMENT_CREATION_KEYS)>-1},WYMeditor.editor.prototype.toggleClass=function(a,b){var c=null;c=this._selectedImage?this._selectedImage:jQuery(this.selected()),c=jQuery(c).parentsOrSelf(b),jQuery(c).toggleClass(a),jQuery(c).attr(WYMeditor.CLASS)||jQuery(c).removeAttr(this._class)},WYMeditor.editor.prototype.findUp=function(a,b){if("undefined"==typeof a||null===a)return null;"#text"===a.nodeName&&(a=a.parentNode);var c,d,e=a.tagName.toLowerCase();if(typeof b===WYMeditor.STRING)for(;e!==b&&e!==WYMeditor.BODY;)a=a.parentNode,e=a.tagName.toLowerCase();else for(c=!1;!c&&e!==WYMeditor.BODY;){for(d=0;d<b.length;d+=1)if(e===b[d]){c=!0;break}if(!c){if(a=a.parentNode,null===a)return null;e=a.tagName.toLowerCase()}}return e===WYMeditor.BODY?null:a},WYMeditor.editor.prototype.switchTo=function(a,b,c){var d,e=this._doc.createElement(b),f=jQuery(a).html(),g=a.attributes;if(!c)for(d=0;d<g.length;++d)e.setAttribute(g.item(d).nodeName,g.item(d).nodeValue);e.innerHTML=f,a.parentNode.replaceChild(e,a),this.setFocusToNode(e)},WYMeditor.editor.prototype.replaceStrings=function(sVal){var key;if(!WYMeditor.STRINGS[this._options.lang])try{eval(jQuery.ajax({url:this._options.langPath+this._options.lang+".js",async:!1}).responseText)}catch(e){return WYMeditor.console.error("WYMeditor: error while parsing language file."),sVal}for(key in WYMeditor.STRINGS[this._options.lang])WYMeditor.STRINGS[this._options.lang].hasOwnProperty(key)&&(sVal=WYMeditor.Helper.replaceAll(sVal,this._options.stringDelimiterLeft+key+this._options.stringDelimiterRight,WYMeditor.STRINGS[this._options.lang][key]));return sVal},WYMeditor.editor.prototype.encloseString=function(a){return this._options.stringDelimiterLeft+a+this._options.stringDelimiterRight},WYMeditor.editor.prototype.status=function(a){jQuery(this._box).find(this._options.statusSelector).html(a)},WYMeditor.editor.prototype.update=function(){var a;a=this.xhtml(),jQuery(this._element).val(a),jQuery(this._box).find(this._options.htmlValSelector).not(".hasfocus").val(a),this.fixBodyHtml()},WYMeditor.editor.prototype.fixBodyHtml=function(){var a=this;a.spaceBlockingElements(),a.fixDoubleBr(),jQuery(a._element).trigger(WYMeditor.EVENTS.postBlockMaybeCreated,a)},WYMeditor.editor.prototype.spaceBlockingElements=function(){var a,b,c,d,e,f,g=WYMeditor.DocumentStructureManager.CONTAINERS_BLOCKING_NAVIGATION.join(", "),h=jQuery(this._doc).find("body.wym_iframe"),i=h.children();a=jQuery.browser.mozilla?'<br class="'+WYMeditor.BLOCKING_ELEMENT_SPACER_CLASS+" "+WYMeditor.EDITOR_ONLY_CLASS+'" _moz_editor_bogus_node="TRUE" _moz_dirty=""/>':'<br class="'+WYMeditor.BLOCKING_ELEMENT_SPACER_CLASS+" "+WYMeditor.EDITOR_ONLY_CLASS+'"/>',i.length>0&&(b=jQuery(i[0]),c=jQuery(i[i.length-1]),b.is(g)&&b.before(a),!c.is(g)||jQuery.browser.msie&&jQuery.browser.version<"7.0"||c.after(a)),d=this._getBlockSepSelector(),h.find(d).before(a),e=this._getBlockInListSepSelector(),f=h.find(e),f.each(function(){var b=jQuery(this);b.next(g).length||b.next(WYMeditor.BR).length||b.after(a)})},WYMeditor.editor.prototype._getBlockSepSelector=function(){if("undefined"!=typeof this._blockSpacersSel)return this._blockSpacersSel;var a,b=this,c=[],d=WYMeditor.DocumentStructureManager.CONTAINERS_BLOCKING_NAVIGATION;return a=jQuery.grep(b.documentStructureManager.structureRules.validRootContainers,function(a){return-1===jQuery.inArray(a,d)}),jQuery.each(d,function(a,b){jQuery.each(d,function(a,d){c.push(b+" + "+d)})}),jQuery.each(d,function(b,d){jQuery.each(a,function(a,b){c.push(d+" + "+b),c.push(b+" + "+d)})}),this._blockSpacersSel=c.join(", "),this._blockSpacersSel},WYMeditor.editor.prototype._getBlockInListSepSelector=function(){if("undefined"!=typeof this._blockInListSpacersSel)return this._blockInListSpacersSel;var a=[];return jQuery.each(WYMeditor.LIST_TYPE_ELEMENTS,function(b,c){jQuery.each(WYMeditor.BLOCKING_ELEMENTS,function(b,d){a.push(c+" "+d)})}),this._blockInListSpacersSel=a.join(", "),this._blockInListSpacersSel},WYMeditor.editor.prototype.fixDoubleBr=function(){var a,b=jQuery(this._doc).find("body.wym_iframe");b.children("br + br").filter(":not(pre br)").remove(),b.find("p + br").next("p").prev("br").remove(),a=b.find("p + br").slice(-1),a.length>0&&0===a.next().length&&a.remove()},WYMeditor.editor.prototype.dialog=function(a,b,c){var d,e,f,g=b||this._wym._options.dialogFeatures,h=window.open("","dialog",g),i=WYMeditor.Helper;if(h){switch(d="",a){case WYMeditor.DIALOG_LINK:d=this._options.dialogLinkHtml;break;case WYMeditor.DIALOG_IMAGE:d=this._options.dialogImageHtml;break;case WYMeditor.DIALOG_TABLE:d=this._options.dialogTableHtml;break;case WYMeditor.DIALOG_PASTE:d=this._options.dialogPasteHtml;break;case WYMeditor.PREVIEW:d=this._options.dialogPreviewHtml;
break;default:d=c}e=this._options.dialogHtml,e=i.replaceAll(e,WYMeditor.BASE_PATH,this._options.basePath),e=i.replaceAll(e,WYMeditor.DIRECTION,this._options.direction),e=i.replaceAll(e,WYMeditor.CSS_PATH,this._options.skinPath+WYMeditor.SKINS_DEFAULT_CSS),e=i.replaceAll(e,WYMeditor.WYM_PATH,this._options.wymPath),e=i.replaceAll(e,WYMeditor.JQUERY_PATH,this._options.jQueryPath),e=i.replaceAll(e,WYMeditor.DIALOG_TITLE,this.encloseString(a)),e=i.replaceAll(e,WYMeditor.DIALOG_BODY,d),e=i.replaceAll(e,WYMeditor.INDEX,this._index),e=this.replaceStrings(e),f=h.document,f.write(e),f.close()}},WYMeditor.editor.prototype.toggleHtml=function(){jQuery(this._box).find(this._options.htmlSelector).toggle()},WYMeditor.editor.prototype.uniqueStamp=function(){var a=new Date;return"wym-"+a.getTime()},WYMeditor.editor.prototype._handleMultilineBlockContainerPaste=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;for(f=jQuery(o),h="p",b.is("li")&&(h="li"),c.splitBoundaries(),o=a.findUp(c.startContainer,["p","h1","h2","h3","h4","h5","h6","li"]),p=o.tagName,i=[],j=[],jQuery(o).contents().each(function(a,b){k=c.compareNode(b),k===c.NODE_BEFORE||k===c.NODE_BEFORE_AND_AFTER&&c.startOffset===c.startContainer.length?i.push(b):j.push(b)}),e=0;e<i.length;e++)jQuery(i[e]).remove();for(e=0;e<j.length;e++)jQuery(j[e]).remove();for(i.length>0&&jQuery(o).prepend(i),j.length>0&&(l=jQuery("<"+p+"></"+p+">",a._doc),l.insertAfter(jQuery(o)),l.append(j)),m=d.splice(0,1)[0],n=m.split(WYMeditor.NEWLINE).join("<br />"),jQuery(o).html(jQuery(o).html()+n),f=jQuery(o),e=0;e<d.length;e++)g="<"+h+">"+d[e].split(WYMeditor.NEWLINE).join("<br />")+"</"+h+">",f=jQuery(g,a._doc).insertAfter(f)},WYMeditor.editor.prototype.paste=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this.selected(),o="",p=!1;if(k=this,i=rangy.getIframeSelection(k._iframe),l=i.getRangeAt(0),f=jQuery(n),l.collapse(!0),b=a.split(new RegExp(WYMeditor.NEWLINE+"{2,}","g")),1===b.length&&(p=!0),"undefined"==typeof n||n&&n.tagName.toLowerCase()===WYMeditor.BODY)if(p)g=jQuery("<p>"+b[0]+"</p>",this._doc).appendTo(this._doc.body);else for(e="p",h=b.length-1;h>=0;h-=1)for(o="<"+e+">"+b[h].split(WYMeditor.NEWLINE).join("<br />")+"</"+e+">",m=jQuery(o,k._doc),c=m.length-1;c>=0;c--)l.insertNode(m[c]);else if(p||f.is("pre"))j=this._doc.createTextNode(a),l.insertNode(j);else if(f.is("p,h1,h2,h3,h4,h5,h6,li"))k._handleMultilineBlockContainerPaste(k,f,l,b);else for(d=a.split(WYMeditor.NEWLINE),h=d.length-1;h>=0;h-=1)j=this._doc.createTextNode(d[h]),l.insertNode(j),h>0&&l.insertNode(jQuery("<br />",k._doc).get(0))},WYMeditor.editor.prototype.insert=function(a){var b,c,d=this._iframe.contentWindow.getSelection();null!==d.focusNode?(b=d.getRangeAt(0),c=b.createContextualFragment(a),b.deleteContents(),b.insertNode(c)):this.paste(a)},WYMeditor.editor.prototype.wrap=function(a,b){this.insert(a+this._iframe.contentWindow.getSelection().toString()+b)},WYMeditor.editor.prototype.unwrap=function(){this.insert(this._iframe.contentWindow.getSelection().toString())},WYMeditor.editor.prototype.setFocusToNode=function(a,b){var c=rangy.createRange(this._doc),d=rangy.getIframeSelection(this._iframe);b=b||!1,c.selectNodeContents(a),c.collapse(b),d.setSingleRange(c)},WYMeditor.editor.prototype.addCssRules=function(a,b){var c,d,e=a.styleSheets[0];if(e)for(c=0;c<b.length;c+=1)d=b[c],d.name&&d.css&&this.addCssRule(e,d)},WYMeditor.editor.prototype.splitListItemContents=function(a){var b,c,d,e=!1,f={itemContents:[],sublistContents:[]};for(b=a.contents(),c=0;c<b.length;c++)d=b.get(c),e||jQuery(d).is("ol,ul")?(e=!0,f.sublistContents.push(d)):f.itemContents.push(d);return f},WYMeditor.editor.prototype.joinAdjacentLists=function(a,b){var c;"undefined"!=typeof a&&"undefined"!=typeof b&&a.nextSibling===b&&a.tagName.toLowerCase()===b.tagName.toLowerCase()&&(c=jQuery(b).contents(),c.unwrap(),c.detach(),jQuery(a).append(c))},WYMeditor.editor.prototype._indentSingleItem=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n=this;b=jQuery(a),c=b.parent()[0].tagName.toLowerCase(),f=n.splitListItemContents(b),h=jQuery(f.sublistContents),g=jQuery(f.itemContents),i=b.prev().filter("li"),0===i.length&&(d='<li class="spacer_li"></li>',b.before(d),i=b.prev()),j=i.contents().last().filter("ol,ul"),j.length>0?(j.append(b),h.detach(),i.append(h),k=h.first(),n.joinAdjacentLists(j.get(0),k.get(0))):(h.length>0?(h.detach(),i.append(h),j=h.first()):(e="<"+c+"></"+c+">",i.append(e),j=i.contents().last()),j.prepend(b)),b.next().is(".spacer_li")&&(l=b.next(".spacer_li"),m=l.contents(),m.detach(),b.append(m),l.remove())},WYMeditor.editor.prototype._outdentSingleItem=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=this;if(b=jQuery(a),c=b.parent()[0].tagName.toLowerCase(),b.parent().parent().is("ol,ul,li")){if(b.parent().parent().is("li")||(WYMeditor.console.log("Attempting to fix invalid list nesting before outdenting."),m.correctInvalidListNesting(a)),e=m.splitListItemContents(b),g=jQuery(e.sublistContents),f=jQuery(e.itemContents),h=b.parent().parent("li"),0===h.length)return WYMeditor.console.error("Invalid list. No parentLi found, so aborting outdent"),void 0;i=b.parent(),j=b.nextAllContents(),k=i.nextAllContents(),b.detach(),h.after(b),g.length>0&&(d="<"+c+'><li class="spacer_li"></li></'+c+">",b.append(d),l=b.children().last(),g.detach(),l.children("li").append(g)),j.length>0&&("undefined"==typeof l&&(d="<"+c+"></"+c+">",b.append(d),l=b.children().last()),j.detach(),l.append(j)),k.length>0&&(k.detach(),b.contents().length>0&&b.contents().last()[0].nodeType===WYMeditor.NODE.TEXT&&k[0].nodeType===WYMeditor.NODE.TEXT&&b.append("<br />"),b.append(k)),0===i.contents().length&&i.remove(),0===h.contents().length&&h.remove()}},WYMeditor.editor.prototype.correctInvalidListNesting=function(a,b){var c,d,e=a;if("undefined"==typeof b&&(b=!1),!e)return b;for(;e.parentNode&&(c=e.parentNode,c.nodeType===WYMeditor.NODE.ELEMENT)&&(d=c.tagName.toLowerCase(),"ol"===d||"ul"===d||"li"===d);)e=c;return jQuery(e).is("li")?(WYMeditor.console.log("Correcting orphaned root li before correcting invalid list nesting."),this._correctOrphanedListItem(e),this.correctInvalidListNesting(e,!0)):jQuery(e).is("ol,ul")?this._correctInvalidListNesting(e,b):(WYMeditor.console.error("Can't correct invalid list nesting. No root list found"),b)},WYMeditor.editor.prototype._correctOrphanedListItem=function(a){var b,c,d,e,f=jQuery();b=jQuery(a).prevContentsUntil(":not(li)"),c=jQuery(a).nextContentsUntil(":not(li)"),f=f.add(b),f=f.add(a),f=f.add(c),e=f[0].previousSibling,e&&jQuery(e).is("ol,ul")?d=e:(f.before("<ol></ol>"),d=f.prev()[0]),jQuery(d).append(f)},WYMeditor.editor.prototype._correctInvalidListNesting=function(a,b){var c,d,e,f,g,h,i=a,j=a,k=!1,l='<li class="spacer_li"></li>';for("undefined"!=typeof b&&(k=b);j;)if(j._wym_visited){if(j._wym_visited=!1,j===i)break;j=j.previousSibling?j.previousSibling:j.parentNode}else{if(j!==i&&!jQuery(j).is("li"))for(e=j;e.parentNode&&(e=e.parentNode,!jQuery(e).is("li"))&&e.nodeType===WYMeditor.NODE.ELEMENT;)if(d=e.tagName.toLowerCase(),"ol"===d||"ul"===d){for(WYMeditor.console.log("Fixing orphaned list content"),k=!0,f=[j],c=j,g=null;c.previousSibling;){if(c=c.previousSibling,jQuery(c).is("li")){g=c;break}f.push(c)}f.reverse(),g||1!==f.length||jQuery(j.nextSibling).is("li")&&(g=j.nextSibling),g||(jQuery(f[0]).before(l),g=jQuery(f[0]).prev()[0]),h=jQuery(g).contents().last(),1===h.length&&h[0].nodeType===WYMeditor.NODE.TEXT&&f[0].nodeType===WYMeditor.NODE.TEXT&&jQuery(g).append("<br />"),jQuery(g).append(jQuery(f));break}j.lastChild?(j._wym_visited=!0,j=j.lastChild):j=j.previousSibling?j.previousSibling:j.parentNode}return k},WYMeditor.editor.prototype.getCommonParentList=function(a,b){var c,d,e,f=!0;return a=jQuery(a).filter("li"),0===a.length?null:(c=a[0],d=jQuery(c).parents("ol,ul"),d=b?d.first():d.last(),0===d.length?null:(e=d[0],jQuery(a).each(function(a,c){d=jQuery(c).parents("ol,ul"),d=b?d.first():d.last(),(0===d.length||d[0]!==e)&&(f=!1)}),f?e:null))},WYMeditor.editor.prototype._getSelectedListItems=function(a){var b,c,d,e,f,g,h,i=this,j=[],k=[];for(f=function(a){var b;if(rangy.dom.isCharacterDataNode(a))return a;try{b=d.containsNodeText(a)}catch(c){return!0}return b===!0?!0:void 0},b=0;b<a.rangeCount;b++)if(d=a.getRangeAt(b),d.collapsed===!0)e=i.findUp(d.startContainer,"li"),e&&(j=j.concat([e]));else{for(j=j.concat(d.getNodes([],f)),g=[],c=0;c<j.length;c++)if(h=j[c],!jQuery(h).is("li,ol,ul"))for(;h.parentNode;)if(h=h.parentNode,jQuery(h).is("li")){g.push(h);break}for(c=0;c<g.length;c++)-1===jQuery.inArray(g[c],j)&&j.push(g[c])}for(b=0;b<j.length;b++)j[b].nodeType===WYMeditor.NODE.ELEMENT&&j[b].tagName.toLowerCase()===WYMeditor.LI&&k.push(j[b]);return k},WYMeditor.editor.prototype._selectionOnlyInList=function(a){var b,c,d,e=this._wym;for(d=0;d<a.rangeCount;++d){if(b=e.findUp(a.getRangeAt(d).startContainer,["li"]),c=e.findUp(a.getRangeAt(d).endContainer,["li"]),!b||!c)return!1;if(!e.getCommonParentList([b,c],!1))return!1}return!0},WYMeditor.editor.prototype.indent=function(){var a,b,c,d=this._wym,e=rangy.getIframeSelection(this._iframe);return b=function(){var a=d.selected(),b=d.findUp(a,["ol","ul","li"]);return d.correctInvalidListNesting(b)},d.restoreSelectionAfterManipulation(b)?!0:(e=rangy.getIframeSelection(this._iframe),d._selectionOnlyInList(e)?(a=d._getSelectedListItems(e),0===a.length?!1:(b=function(){var b=!1;for(c=0;c<a.length;c++)d._indentSingleItem(a[c]),b=!0;return b},d.restoreSelectionAfterManipulation(b))):!1)},WYMeditor.editor.prototype.outdent=function(){var a,b,c,d=this._wym,e=rangy.getIframeSelection(this._iframe);return b=function(){var a=d.selected(),b=d.findUp(a,["ol","ul","li"]);return d.correctInvalidListNesting(b)},d.restoreSelectionAfterManipulation(b)?!0:(e=rangy.getIframeSelection(this._iframe),d._selectionOnlyInList(e)?(a=d._getSelectedListItems(e),0===a.length?!1:(b=function(){var b=!1;for(c=0;c<a.length;c++)d._outdentSingleItem(a[c]),b=!0;return b},d.restoreSelectionAfterManipulation(b))):!1)},WYMeditor.editor.prototype.restoreSelectionAfterManipulation=function(a){var b=rangy.saveSelection(rangy.dom.getIframeWindow(this._iframe)),c=!0;try{c=a(),c?rangy.restoreSelection(b):rangy.removeMarkers(b)}catch(d){WYMeditor.console.error("Error during manipulation"),WYMeditor.console.error(d),rangy.removeMarkers(b)}return c},WYMeditor.editor.prototype.insertOrderedlist=function(){var a,b=this;return a=function(){var a=b.selected(),c=b.findUp(a,["ol","ul","li"]);return b.correctInvalidListNesting(c)},b.restoreSelectionAfterManipulation(a)?!0:(a=function(){return b._insertList("ol")},b.restoreSelectionAfterManipulation(a))},WYMeditor.editor.prototype.insertUnorderedlist=function(){var a,b=this;return a=function(){var a=b.selected(),c=b.findUp(a,["ol","ul","li"]);return b.correctInvalidListNesting(c)},b.restoreSelectionAfterManipulation(a)?!0:(a=function(){return b._insertList("ul")},b.restoreSelectionAfterManipulation(a))},WYMeditor.editor.prototype._insertList=function(a){var b,c,d,e,f=this._wym,g=rangy.getIframeSelection(this._iframe);return b=f._getSelectedListItems(g),0!==b.length?(c=f.getCommonParentList(b,!0),c?(this._changeListType(c,a),!0):!1):(d=this.selected(),e=this.findUp(d,WYMeditor.POTENTIAL_LIST_ELEMENTS),e?(this._convertToList(e,a),!0):!1)},WYMeditor.editor.prototype._changeListType=function(a,b){return WYMeditor.changeNodeType(a,b)},WYMeditor.editor.prototype._convertToList=function(a,b){var c,d,e=jQuery(a);return c="<"+b+"><li></li></"+b+">",this.findUp(a,WYMeditor.MAIN_CONTAINERS)===a?(e.wrapInner(c),d=e.children(),d.unwrap(),d.get(0)):(e.wrapInner(c),d=e.children(),d.get(0))},WYMeditor.editor.prototype.insertTable=function(a,b,c,d){if(!(0>=a||0>=b)){var e,f,g,h,i,j=this._doc.createElement(WYMeditor.TABLE),k=null;for(e=j.createCaption(),e.innerHTML=c,f=0;a>f;f+=1)for(k=j.insertRow(f),g=0;b>g;g+=1)k.insertCell(g);if(""!==d&&jQuery(j).attr("summary",d),h=jQuery(this.findUp(this.container(),WYMeditor.POTENTIAL_TABLE_INSERT_ELEMENTS)).get(0),h&&h.parentNode)if(jQuery.inArray(h.nodeName.toLowerCase(),WYMeditor.INLINE_TABLE_INSERTION_ELEMENTS)>-1){if(i=this.selection().focusNode,jQuery.inArray(i.nodeName.toLowerCase(),WYMeditor.SELECTABLE_TABLE_ELEMENTS)>-1||jQuery.inArray(i.parentNode.nodeName.toLowerCase(),WYMeditor.SELECTABLE_TABLE_ELEMENTS)>-1)for(;i.nodeName.toLowerCase()!==WYMeditor.TABLE;)i=i.parentNode;i.nodeName.toLowerCase()===WYMeditor.LI?jQuery(i).append(j):jQuery(i).after(j)}else jQuery(h).after(j);else jQuery(this._doc.body).append(j);return this.afterInsertTable(j),this.fixBodyHtml(),j}},WYMeditor.editor.prototype.afterInsertTable=function(){},WYMeditor.editor.prototype.configureEditorUsingRawCss=function(){var a=new WYMeditor.WymCssParser;this._options.stylesheet?a.parse(jQuery.ajax({url:this._options.stylesheet,async:!1}).responseText):a.parse(this._options.styles,!1),0===this._options.classesItems.length&&(this._options.classesItems=a.css_settings.classesItems),0===this._options.editorStyles.length&&(this._options.editorStyles=a.css_settings.editorStyles),0===this._options.dialogStyles.length&&(this._options.dialogStyles=a.css_settings.dialogStyles)},WYMeditor.editor.prototype.listen=function(){var a=this;jQuery(this._doc.body).bind("mousedown",function(b){a.mousedown(b)})},WYMeditor.editor.prototype.mousedown=function(a){this._selectedImage=null,a.target.tagName.toLowerCase()===WYMeditor.IMG&&(this._selectedImage=a.target)},WYMeditor.loadCss=function(a){var b,c=document.createElement("link");c.rel="stylesheet",c.href=a,b=jQuery("head").get(0),b.appendChild(c)},WYMeditor.editor.prototype.loadSkin=function(){if(this._options.loadSkin&&!WYMeditor.SKINS[this._options.skin]){var found=!1,rExp=new RegExp(this._options.skin+"/"+WYMeditor.SKINS_DEFAULT_CSS+"$");jQuery("link").each(function(){this.href.match(rExp)&&(found=!0)}),found||WYMeditor.loadCss(this._options.skinPath+WYMeditor.SKINS_DEFAULT_CSS)}jQuery(this._box).addClass("wym_skin_"+this._options.skin),this._options.initSkin&&!WYMeditor.SKINS[this._options.skin]&&eval(jQuery.ajax({url:this._options.skinPath+WYMeditor.SKINS_DEFAULT_JS,async:!1}).responseText),WYMeditor.SKINS[this._options.skin]&&WYMeditor.SKINS[this._options.skin].init&&WYMeditor.SKINS[this._options.skin].init(this)},WYMeditor.DocumentStructureManager=function(a,b){this._wym=a,this.structureRules=WYMeditor.DocumentStructureManager.DEFAULTS,this.setDefaultRootContainer(b)},jQuery.extend(WYMeditor.DocumentStructureManager,{VALID_DEFAULT_ROOT_CONTAINERS:["p","div"],DEFAULT_ROOT_CONTAINER_TITLES:{p:"Paragraph",div:"Division"},CONTAINERS_BLOCKING_NAVIGATION:["table","blockquote","pre"],DEFAULTS:{defaultRootContainer:"p",notValidRootContainers:["div"],validRootContainers:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","table","ol","ul"],convertIfRootContainers:["div"],validListConversionTargetContainers:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote","td","th"],wrapContentsInList:["td","th"]}}),WYMeditor.DocumentStructureManager.prototype.setDefaultRootContainer=function(a){var b,c,d;if(this.structureRules.defaultRootContainer!==a){if(d=WYMeditor.DocumentStructureManager,b=d.VALID_DEFAULT_ROOT_CONTAINERS,c=jQuery.inArray(a,b),-1===c)throw new Error("a defaultRootContainer of '"+a+"' is not supported");this.structureRules.defaultRootContainer=a,this.structureRules.notValidRootContainers=WYMeditor.DocumentStructureManager.VALID_DEFAULT_ROOT_CONTAINERS,this.structureRules.notValidRootContainers.splice(c,1),this.adjustDefaultRootContainerUI()}},WYMeditor.DocumentStructureManager.prototype.adjustDefaultRootContainerUI=function(){var a,b,c,d,e,f,g,h,i=this._wym,j=this.structureRules.defaultRootContainer;for(a=jQuery(i._box).find(i._options.containersSelector).find("li"),e=!0,g=0;g<a.length;++g)b=a.eq(g).find("a"),d=b.attr("name").toLowerCase(),jQuery.inArray(d,this.structureRules.notValidRootContainers)>-1&&a.eq(g).remove(),d===j&&(e=!1);e&&(f=i._options.containersItemHtml,f=WYMeditor.Helper.replaceAll(f,WYMeditor.CONTAINER_NAME,j.toUpperCase()),h=WYMeditor.DocumentStructureManager,f=WYMeditor.Helper.replaceAll(f,WYMeditor.CONTAINER_TITLE,h.DEFAULT_ROOT_CONTAINER_TITLES[j]),f=WYMeditor.Helper.replaceAll(f,WYMeditor.CONTAINER_CLASS,"wym_containers_"+j),c=jQuery(f),a=jQuery(i._box).find(i._options.containersSelector).find("li"),a.eq(0).before(c),c.find("a").click(function(){return i.container(jQuery(this).attr(WYMeditor.NAME)),!1}))},WYMeditor.WymClassMozilla=function(a){this._wym=a,this._class="class"},WYMeditor.WymClassMozilla.CELL_PLACEHOLDER='<br _moz_dirty="" />',WYMeditor.WymClassMozilla.NEEDS_CELL_FIX=1===parseInt(jQuery.browser.version,10)&&jQuery.browser.version>="1.9.1"&&jQuery.browser.version<"2.0",WYMeditor.WymClassMozilla.prototype.initIframe=function(iframe){var wym=this,styles,aCss;this._iframe=iframe,this._doc=iframe.contentDocument,styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles),this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._html(this._wym._options.html),this.enableDesignMode(),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery(this._doc).bind("click",this.click),jQuery(this._doc).bind("focus",function(){wym.enableDesignMode.call(wym)}),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen(),jQuery(wym._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)},WYMeditor.WymClassMozilla.prototype._html=function(a){if("string"!=typeof a)return jQuery(this._doc.body).html();try{this._doc.designMode="off"}catch(b){}return a=a.replace(/<em(\b[^>]*)>/gi,"<i$1>"),a=a.replace(/<\/em>/gi,"</i>"),a=a.replace(/<strong(\b[^>]*)>/gi,"<b$1>"),a=a.replace(/<\/strong>/gi,"</b>"),jQuery(this._doc.body).html(a),this._wym.fixBodyHtml(),this.enableDesignMode(),!1},WYMeditor.WymClassMozilla.prototype._exec=function(a,b){if(!this.selected())return!1;b?this._doc.execCommand(a,"",b):this._doc.execCommand(a,"",null);var c=this.selected();return c&&c.tagName.toLowerCase()===WYMeditor.BODY&&(this._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P),this.fixBodyHtml()),!0},WYMeditor.WymClassMozilla.prototype.addCssRule=function(a,b){a.insertRule(b.name+" {"+b.css+"}",a.cssRules.length)},WYMeditor.WymClassMozilla.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title];if(a.ctrlKey){if(66===a.which)return b._exec(WYMeditor.BOLD),!1;if(73===a.which)return b._exec(WYMeditor.ITALIC),!1}return!0},WYMeditor.WymClassMozilla.prototype.keyup=function(a){var b,c,d,e,f,g=WYMeditor.INSTANCES[this.title];d=g.documentStructureManager.structureRules.notValidRootContainers,c=g.documentStructureManager.structureRules.defaultRootContainer,g._selectedImage=null,b=null,g.keyCanCreateBlockElement(a.which)||a.which===WYMeditor.KEY.CTRL||a.which===WYMeditor.KEY.COMMAND||a.metaKey||a.ctrlKey||(b=g.selected(),e=b.tagName.toLowerCase(),b.parentNode&&(f=b.parentNode.tagName.toLowerCase()),g.isForbiddenMainContainer(e)&&(e=f),(e===WYMeditor.BODY||jQuery.inArray(e,d)>-1&&f===WYMeditor.BODY)&&(g._exec(WYMeditor.FORMAT_BLOCK,c),g.fixBodyHtml())),g.keyCanCreateBlockElement(a.which)&&(b=g.selected(),e=b.tagName.toLowerCase(),b.parentNode&&(f=b.parentNode.tagName.toLowerCase()),jQuery.inArray(e,d)>-1&&f===WYMeditor.BODY&&g._exec(WYMeditor.FORMAT_BLOCK,c),g.fixBodyHtml())},WYMeditor.WymClassMozilla.prototype.click=function(){var a,b=WYMeditor.INSTANCES[this.title],c=b.selected();WYMeditor.WymClassMozilla.NEEDS_CELL_FIX===!0&&c&&c.tagName.toLowerCase()===WYMeditor.TR&&jQuery(WYMeditor.TD,b._doc.body).append(WYMeditor.WymClassMozilla.CELL_PLACEHOLDER),c&&c.tagName.toLowerCase()===WYMeditor.BODY&&(a=b._iframe.contentWindow.getSelection(),a.isCollapsed===!0&&b._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P))},WYMeditor.WymClassMozilla.prototype.enableDesignMode=function(){if("off"===this._doc.designMode)try{this._doc.designMode="on",this._doc.execCommand("styleWithCSS","",!1),this._doc.execCommand("enableObjectResizing",!1,!0)}catch(a){}},WYMeditor.WymClassMozilla.prototype.afterInsertTable=function(a){WYMeditor.WymClassMozilla.NEEDS_CELL_FIX===!0&&jQuery(a).find("td").each(function(a,b){jQuery(b).append(WYMeditor.WymClassMozilla.CELL_PLACEHOLDER)})},WYMeditor.WymClassExplorer=function(a){this._wym=a,this._class="className"},WYMeditor.WymClassExplorer.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var aCss=eval(this._options.editorStyles),wym,ieVersion=parseInt(jQuery.browser.version,10);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),jQuery(this._doc.body).html(this._wym._options.html),wym=this,this._doc.body.onfocus=function(){wym._doc.designMode="on",wym._doc=iframe.contentWindow.document},this._doc.onbeforedeactivate=function(){wym.saveCaret()},jQuery(this._doc).bind("keyup",wym.keyup),ieVersion>=8&&9>ieVersion&&jQuery(this._doc).bind("keydown",function(){wym.fixBluescreenOfDeath()}),this._doc.onkeyup=function(){wym.saveCaret()},this._doc.onclick=function(){wym.saveCaret()},this._doc.body.onbeforepaste=function(){wym._iframe.contentWindow.event.returnValue=!1},this._doc.body.onpaste=function(){wym._iframe.contentWindow.event.returnValue=!1,wym.paste(window.clipboardData.getData("Text"))},this._initialized&&(jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()),this._initialized=!0,this._doc.designMode="on";try{this._doc=iframe.contentWindow.document}catch(e){}jQuery(wym._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)},function(a){WYMeditor.WymClassExplorer.prototype.loadSkin=function(){jQuery(this._box).find(this._options.containerSelector).attr("unselectable","on"),a.call(this)}}(WYMeditor.editor.prototype.loadSkin),WYMeditor.WymClassExplorer.prototype.fixBluescreenOfDeath=function(){var a=jQuery(this._doc).find("p").eq(0).position();null!==a&&"undefined"!=typeof a&&a.left<0&&(jQuery(this._box).append('<br id="wym-bluescreen-bug-fix" />'),jQuery(this._box).find("#wym-bluescreen-bug-fix").remove())},WYMeditor.WymClassExplorer.prototype._exec=function(a,b){b?this._doc.execCommand(a,!1,b):this._doc.execCommand(a)},WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()},WYMeditor.WymClassExplorer.prototype.addCssRule=function(a,b){var c,d=b.name.split(",");for(c=0;c<d.length;c++)a.addRule(d[c],b.css)},WYMeditor.WymClassExplorer.prototype.insert=function(a){var b,c=this._doc.selection.createRange();if(b=jQuery(c.parentElement()).parents(),b.is(this._options.iframeBodySelector))try{c.pasteHTML(a)}catch(d){}else this.paste(a)},WYMeditor.WymClassExplorer.prototype.wrap=function(a,b){var c,d=this._doc.selection.createRange();if(c=jQuery(d.parentElement()).parents(),c.is(this._options.iframeBodySelector))try{d.pasteHTML(a+d.text+b)}catch(e){}},WYMeditor.WymClassExplorer.prototype.wrapWithContainer=function(a,b){var c,d,e,f=this._wym;c=jQuery(a).wrap("<"+b+" />"),d=rangy.getIframeSelection(f._iframe),e=rangy.createRange(f._doc),e.selectNodeContents(c[0]),e.collapse(),d.setSingleRange(e)},WYMeditor.WymClassExplorer.prototype.unwrap=function(){var a,b,c=this._doc.selection.createRange();if(a=jQuery(c.parentElement()).parents(),a.is(this._options.iframeBodySelector))try{b=c.text,this._exec("Cut"),c.pasteHTML(b)}catch(d){}},WYMeditor.WymClassExplorer.prototype.keyup=function(a){var b,c,d,e,f,g,h=WYMeditor.INSTANCES[this.title],i=!1;d=h.documentStructureManager.structureRules.notValidRootContainers,c=h.documentStructureManager.structureRules.defaultRootContainer,this._selectedImage=null,h.keyCanCreateBlockElement(a.which)||a.which===WYMeditor.KEY.CTRL||a.which===WYMeditor.KEY.COMMAND||a.metaKey||a.ctrlKey||(b=h.selected(),g=h.selection().focusNode,null!==b&&(e=b.tagName.toLowerCase()),b.parentNode&&(f=b.parentNode.tagName.toLowerCase()),h.isForbiddenMainContainer(e)&&(e=f,i=!0),e===WYMeditor.BODY&&"#text"===g.nodeName&&(i&&(g=g.parentNode),h.wrapWithContainer(g,c),h.fixBodyHtml()),jQuery.inArray(e,d)>-1&&f===WYMeditor.BODY&&(h.switchTo(b,c),h.fixBodyHtml())),h.keyCanCreateBlockElement(a.which)&&(b=h.selected(),e=b.tagName.toLowerCase(),b.parentNode&&(f=b.parentNode.tagName.toLowerCase()),jQuery.inArray(e,d)>-1&&f===WYMeditor.BODY&&h.switchTo(b,c),h.fixBodyHtml())},WYMeditor.WymClassOpera=function(a){this._wym=a,this._class="class"},WYMeditor.WymClassOpera.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this._html(this._wym._options.html),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen(),jQuery(wym._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)},WYMeditor.WymClassOpera.prototype._exec=function(a,b){b?this._doc.execCommand(a,!1,b):this._doc.execCommand(a)},WYMeditor.WymClassOpera.prototype.selected=function(){var a=this._iframe.contentWindow.getSelection(),b=a.focusNode;return b?"#text"===b.nodeName?b.parentNode:b:null},WYMeditor.WymClassOpera.prototype.addCssRule=function(a,b){a.insertRule(b.name+" {"+b.css+"}",a.cssRules.length)},WYMeditor.WymClassOpera.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title],c=b._iframe.contentWindow.getSelection();startNode=c.getRangeAt(0).startContainer,jQuery(startNode).parentsOrSelf(WYMeditor.MAIN_CONTAINERS.join(","))[0]||jQuery(startNode).parentsOrSelf("li")||keyCanCreateBlockElement(a.which)||b._exec(WYMeditor.FORMAT_BLOCK,WYMeditor.P)},WYMeditor.WymClassOpera.prototype.keyup=function(){var a=WYMeditor.INSTANCES[this.title];a._selectedImage=null},WYMeditor.WymClassSafari=function(a){this._wym=a,this._class="class"},WYMeditor.WymClassSafari.prototype.initIframe=function(iframe){var wym=this,styles,aCss;this._iframe=iframe,this._doc=iframe.contentDocument,styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles),this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,jQuery("html",this._doc).attr("dir",this._options.direction),this._doc.designMode="on",this._html(this._wym._options.html),jQuery.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),jQuery(this._doc).bind("keydown",this.keydown),jQuery(this._doc).bind("keyup",this.keyup),jQuery.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen(),jQuery(wym._element).trigger(WYMeditor.EVENTS.postIframeInitialization,this._wym)},WYMeditor.WymClassSafari.prototype._exec=function(a,b){if(!this.selected())return!1;var c,d,e,f,g;return b?this._doc.execCommand(a,"",b):this._doc.execCommand(a,"",null),c=this.selected(),c&&(d=jQuery(c),e=c.tagName.toLowerCase(),e===WYMeditor.BODY&&(f=this.documentStructureManager.structureRules,this._exec(WYMeditor.FORMAT_BLOCK,f.defaultRootContainer),this.fixBodyHtml()),a===WYMeditor.FORMAT_BLOCK&&d.siblings("body.wym_iframe").length&&d.siblings("body.wym_iframe").append(c),"span"===e&&(g=!d.attr("class")||"apple-style-span"===d.attr("class").toLowerCase(),g&&"font-weight: normal;"===d.attr("style")&&d.contents().unwrap())),!0},WYMeditor.WymClassSafari.prototype.addCssRule=function(a,b){a.insertRule(b.name+" {"+b.css+"}",a.cssRules.length)},WYMeditor.WymClassSafari.prototype.keydown=function(a){var b=WYMeditor.INSTANCES[this.title];a.ctrlKey?(a.which===WYMeditor.KEY.B&&(b._exec(WYMeditor.BOLD),a.preventDefault()),a.which===WYMeditor.KEY.I&&(b._exec(WYMeditor.ITALIC),a.preventDefault())):a.shiftKey&&a.which===WYMeditor.KEY.ENTER&&(b._exec("InsertLineBreak"),a.preventDefault())},WYMeditor.WymClassSafari.prototype.keyup=function(a){var b,c,d,e,f,g=WYMeditor.INSTANCES[this.title];d=g.documentStructureManager.structureRules.notValidRootContainers,c=g.documentStructureManager.structureRules.defaultRootContainer,g._selectedImage=null,jQuery.browser.version<534.1&&a.which===WYMeditor.KEY.ENTER&&a.shiftKey&&g._exec("InsertLineBreak"),g.keyCanCreateBlockElement(a.which)||a.which===WYMeditor.KEY.CTRL||a.which===WYMeditor.KEY.COMMAND||a.metaKey||a.ctrlKey||(b=g.selected(),e=b.tagName.toLowerCase(),b.parentNode&&(f=b.parentNode.tagName.toLowerCase()),g.isForbiddenMainContainer(e)&&(e=f),(e===WYMeditor.BODY||jQuery.inArray(e,d)>-1&&f===WYMeditor.BODY)&&(g._exec(WYMeditor.FORMAT_BLOCK,c),g.fixBodyHtml())),g.keyCanCreateBlockElement(a.which)&&(b=g.selected(),e=b.tagName.toLowerCase(),b.parentNode&&(f=b.parentNode.tagName.toLowerCase()),jQuery.inArray(e,d)>-1&&f===WYMeditor.BODY&&g._exec(WYMeditor.FORMAT_BLOCK,c),g.fixBodyHtml())},WYMeditor.WymCssLexer=function(a,b){return b="undefined"==typeof b?!0:b,jQuery.extend(this,new WYMeditor.Lexer(a,b?"Ignore":"WymCss")),this.mapHandler("WymCss","Ignore"),b===!0&&(this.addEntryPattern("/\\*[<\\s]*WYMeditor[>\\s]*\\*/","Ignore","WymCss"),this.addExitPattern("/\\*[</\\s]*WYMeditor[>\\s]*\\*/","WymCss")),this.addSpecialPattern("[\\sa-z1-6]*\\.[a-z-_0-9]+","WymCss","WymCssStyleDeclaration"),this.addEntryPattern("/\\*","WymCss","WymCssComment"),this.addExitPattern("\\*/","WymCssComment"),this.addEntryPattern("{","WymCss","WymCssStyle"),this.addExitPattern("}","WymCssStyle"),this.addEntryPattern("/\\*","WymCssStyle","WymCssFeedbackStyle"),this.addExitPattern("\\*/","WymCssFeedbackStyle"),this},WYMeditor.WymCssParser=function(){return this._in_style=!1,this._has_title=!1,this.only_wym_blocks=!0,this.css_settings={classesItems:[],editorStyles:[],dialogStyles:[]},this},WYMeditor.WymCssParser.prototype.parse=function(a,b){b="undefined"==typeof b?this.only_wym_blocks:b,this._Lexer=new WYMeditor.WymCssLexer(this,b),this._Lexer.parse(a)},WYMeditor.WymCssParser.prototype.Ignore=function(){return!0},WYMeditor.WymCssParser.prototype.WymCssComment=function(a,b){return a.match(/end[a-z0-9\s]*wym[a-z0-9\s]*/im)?!1:(b==WYMeditor.LEXER_UNMATCHED&&(this._in_style?this._current_item[this._current_element]&&(this._current_item[this._current_element].expressions?this._current_item[this._current_element].expressions.push(a):this._current_item[this._current_element].expressions=[a]):(this._has_title=!0,this._current_item={title:WYMeditor.Helper.trim(a)}),this._in_style=!0),!0)},WYMeditor.WymCssParser.prototype.WymCssStyle=function(a,b){return b==WYMeditor.LEXER_UNMATCHED?(a=WYMeditor.Helper.trim(a),""!==a&&(this._current_item[this._current_element].style=a)):b==WYMeditor.LEXER_EXIT&&(this._in_style=!1,this._has_title=!1,this.addStyleSetting(this._current_item)),!0},WYMeditor.WymCssParser.prototype.WymCssFeedbackStyle=function(a,b){return b==WYMeditor.LEXER_UNMATCHED&&(this._current_item[this._current_element].feedback_style=a.replace(/^([\s\/\*]*)|([\s\/\*]*)$/gm,"")),!0},WYMeditor.WymCssParser.prototype.WymCssStyleDeclaration=function(a){a=a.replace(/^([\s\.]*)|([\s\.*]*)$/gm,"");var b="";if(a.indexOf(".")>0){var c=a.split(".");this._current_element=c[1],b=c[0]}else this._current_element=a;return this._has_title||(this._current_item={title:(b?b.toUpperCase()+": ":"")+this._current_element},this._has_title=!0),this._current_item[this._current_element]||(this._current_item[this._current_element]={name:this._current_element}),b&&(this._current_item[this._current_element].tags?this._current_item[this._current_element].tags.push(b):this._current_item[this._current_element].tags=[b]),!0},WYMeditor.WymCssParser.prototype.addStyleSetting=function(a){for(var b in a){var c=a[b];"object"==typeof c&&"title"!=b&&(this.css_settings.classesItems.push({name:WYMeditor.Helper.trim(c.name),title:a.title,expr:WYMeditor.Helper.trim((c.expressions||c.tags).join(", "))}),c.feedback_style&&this.css_settings.editorStyles.push({name:"."+WYMeditor.Helper.trim(c.name),css:c.feedback_style}),c.style&&this.css_settings.dialogStyles.push({name:"."+WYMeditor.Helper.trim(c.name),css:c.style}))
}},WYMeditor.LEXER_ENTER=1,WYMeditor.LEXER_MATCHED=2,WYMeditor.LEXER_UNMATCHED=3,WYMeditor.LEXER_EXIT=4,WYMeditor.LEXER_SPECIAL=5,WYMeditor.Lexer=function(a,b,c){return b=b||"accept",this._case=c||!1,this._regexes={},this._parser=a,this._mode=new WYMeditor.StateStack(b),this._mode_handlers={},this._mode_handlers[b]=b,this},WYMeditor.Lexer.prototype.addPattern=function(a,b){b=b||"accept","undefined"==typeof this._regexes[b]&&(this._regexes[b]=new WYMeditor.ParallelRegex(this._case)),this._regexes[b].addPattern(a),"undefined"==typeof this._mode_handlers[b]&&(this._mode_handlers[b]=b)},WYMeditor.Lexer.prototype.addEntryPattern=function(a,b,c){"undefined"==typeof this._regexes[b]&&(this._regexes[b]=new WYMeditor.ParallelRegex(this._case)),this._regexes[b].addPattern(a,c),"undefined"==typeof this._mode_handlers[c]&&(this._mode_handlers[c]=c)},WYMeditor.Lexer.prototype.addExitPattern=function(a,b){"undefined"==typeof this._regexes[b]&&(this._regexes[b]=new WYMeditor.ParallelRegex(this._case)),this._regexes[b].addPattern(a,"__exit"),"undefined"==typeof this._mode_handlers[b]&&(this._mode_handlers[b]=b)},WYMeditor.Lexer.prototype.addSpecialPattern=function(a,b,c){"undefined"==typeof this._regexes[b]&&(this._regexes[b]=new WYMeditor.ParallelRegex(this._case)),this._regexes[b].addPattern(a,"_"+c),"undefined"==typeof this._mode_handlers[c]&&(this._mode_handlers[c]=c)},WYMeditor.Lexer.prototype.mapHandler=function(a,b){this._mode_handlers[a]=b},WYMeditor.Lexer.prototype.parse=function(a){if("undefined"==typeof this._parser)return!1;for(var b,c=a.length;"object"==typeof(b=this._reduce(a));){a=b[0];var d=b[1],e=b[2],f=b[3];if(!this._dispatchTokens(d,e,f))return!1;if(""===a)return!0;if(a.length==c)return!1;c=a.length}return b?this._invokeParser(a,WYMeditor.LEXER_UNMATCHED):!1},WYMeditor.Lexer.prototype._dispatchTokens=function(a,b,c){return c=c||!1,this._invokeParser(a,WYMeditor.LEXER_UNMATCHED)?"boolean"==typeof c?this._invokeParser(b,WYMeditor.LEXER_MATCHED):this._isModeEnd(c)?this._invokeParser(b,WYMeditor.LEXER_EXIT)?this._mode.leave():!1:this._isSpecialMode(c)?(this._mode.enter(this._decodeSpecial(c)),this._invokeParser(b,WYMeditor.LEXER_SPECIAL)?this._mode.leave():!1):(this._mode.enter(c),this._invokeParser(b,WYMeditor.LEXER_ENTER)):!1},WYMeditor.Lexer.prototype._isModeEnd=function(a){return"__exit"===a},WYMeditor.Lexer.prototype._isSpecialMode=function(a){return"_"==a.substring(0,1)},WYMeditor.Lexer.prototype._decodeSpecial=function(a){return a.substring(1)},WYMeditor.Lexer.prototype._invokeParser=function(a,b){if(""===a)return!0;var c=this._mode.getCurrent(),d=this._mode_handlers[c],e=this._parser[d](a,b);return e},WYMeditor.Lexer.prototype._reduce=function(a){var b=this._regexes[this._mode.getCurrent()].match(a),c=b[1],d=b[0];if(d){var e=a.indexOf(c),f=a.substr(0,e);return a=a.substring(e+c.length),[a,f,c,d]}return!0},WYMeditor.ParallelRegex=function(a){return this._case=a,this._patterns=[],this._labels=[],this._regex=null,this},WYMeditor.ParallelRegex.prototype.addPattern=function(a,b){b=b||!0;var c=this._patterns.length;this._patterns[c]=a,this._labels[c]=b,this._regex=null},WYMeditor.ParallelRegex.prototype.match=function(a){if(0===this._patterns.length)return[!1,""];var b=a.match(this._getCompoundedRegex());if(!b)return[!1,""];for(var c=b[0],d=1;d<b.length;d++)if(b[d])return[this._labels[d-1],c];return[!0,b[0]]},WYMeditor.ParallelRegex.prototype._getCompoundedRegex=function(){if(null===this._regex){for(var a=0,b=this._patterns.length;b>a;a++)this._patterns[a]="("+this._untokenizeRegex(this._tokenizeRegex(this._patterns[a]).replace(/([\/\(\)])/g,"\\$1"))+")";this._regex=new RegExp(this._patterns.join("|"),this._getPerlMatchingFlags())}return this._regex},WYMeditor.ParallelRegex.prototype._tokenizeRegex=function(a){return a.replace(/\(\?(i|m|s|x|U)\)/,"~~~~~~Tk1$1~~~~~~").replace(/\(\?(\-[i|m|s|x|U])\)/,"~~~~~~Tk2$1~~~~~~").replace(/\(\?\=(.*)\)/,"~~~~~~Tk3$1~~~~~~").replace(/\(\?\!(.*)\)/,"~~~~~~Tk4$1~~~~~~").replace(/\(\?\<\=(.*)\)/,"~~~~~~Tk5$1~~~~~~").replace(/\(\?\<\!(.*)\)/,"~~~~~~Tk6$1~~~~~~").replace(/\(\?\:(.*)\)/,"~~~~~~Tk7$1~~~~~~")},WYMeditor.ParallelRegex.prototype._untokenizeRegex=function(a){return a.replace(/~~~~~~Tk1(.{1})~~~~~~/,"(?$1)").replace(/~~~~~~Tk2(.{2})~~~~~~/,"(?$1)").replace(/~~~~~~Tk3(.*)~~~~~~/,"(?=$1)").replace(/~~~~~~Tk4(.*)~~~~~~/,"(?!$1)").replace(/~~~~~~Tk5(.*)~~~~~~/,"(?<=$1)").replace(/~~~~~~Tk6(.*)~~~~~~/,"(?<!$1)").replace(/~~~~~~Tk7(.*)~~~~~~/,"(?:$1)")},WYMeditor.ParallelRegex.prototype._getPerlMatchingFlags=function(){return this._case?"m":"mi"},WYMeditor.StateStack=function(a){return this._stack=[a],this},WYMeditor.StateStack.prototype.getCurrent=function(){return this._stack[this._stack.length-1]},WYMeditor.StateStack.prototype.enter=function(a){this._stack.push(a)},WYMeditor.StateStack.prototype.leave=function(){return 1==this._stack.length?!1:(this._stack.pop(),!0)},WYMeditor.XhtmlLexer=function(a){return jQuery.extend(this,new WYMeditor.Lexer(a,"Text")),this.mapHandler("Text","Text"),this.addTokens(),this.init(),this},WYMeditor.XhtmlLexer.prototype.init=function(){},WYMeditor.XhtmlLexer.prototype.addTokens=function(){this.addCommentTokens("Text"),this.addScriptTokens("Text"),this.addCssTokens("Text"),this.addTagTokens("Text")},WYMeditor.XhtmlLexer.prototype.addCommentTokens=function(a){this.addEntryPattern("<!--",a,"Comment"),this.addExitPattern("-->","Comment")},WYMeditor.XhtmlLexer.prototype.addScriptTokens=function(a){this.addEntryPattern("<script",a,"Script"),this.addExitPattern("</script>","Script")},WYMeditor.XhtmlLexer.prototype.addCssTokens=function(a){this.addEntryPattern("<style",a,"Css"),this.addExitPattern("</style>","Css")},WYMeditor.XhtmlLexer.prototype.addTagTokens=function(a){this.addSpecialPattern("<\\s*[a-z0-9:-]+\\s*/>",a,"SelfClosingTag"),this.addSpecialPattern("<\\s*[a-z0-9:-]+\\s*>",a,"OpeningTag"),this.addEntryPattern("<[a-z0-9:-]+[\\/ \\>]+",a,"OpeningTag"),this.addInTagDeclarationTokens("OpeningTag"),this.addSpecialPattern("</\\s*[a-z0-9:-]+\\s*>",a,"ClosingTag")},WYMeditor.XhtmlLexer.prototype.addInTagDeclarationTokens=function(a){this.addSpecialPattern("\\s+",a,"Ignore"),this.addAttributeTokens(a),this.addExitPattern("/>",a),this.addExitPattern(">",a)},WYMeditor.XhtmlLexer.prototype.addAttributeTokens=function(a){this.addSpecialPattern("\\s*[a-z-_0-9]*:?[a-z-_0-9]+\\s*(?==)\\s*",a,"TagAttributes"),this.addEntryPattern('=\\s*"',a,"DoubleQuotedAttribute"),this.addPattern('\\\\"',"DoubleQuotedAttribute"),this.addExitPattern('"',"DoubleQuotedAttribute"),this.addEntryPattern("=\\s*'",a,"SingleQuotedAttribute"),this.addPattern("\\\\'","SingleQuotedAttribute"),this.addExitPattern("'","SingleQuotedAttribute"),this.addSpecialPattern("=\\s*[^>\\s]*",a,"UnquotedAttribute")},WYMeditor.XhtmlParser=function(a,b){return b=b||"Text",this._Lexer=new WYMeditor.XhtmlLexer(this),this._Listener=a,this._mode=b,this._matches=[],this._last_match="",this._current_match="",this},WYMeditor.XhtmlParser.prototype.parse=function(a){return this._Lexer.parse(this.beforeParsing(a)),this.afterParsing(this._Listener.getResult())},WYMeditor.XhtmlParser.prototype.beforeParsing=function(a){return(a.match(/class="MsoNormal"/)||a.match(/ns = "urn:schemas-microsoft-com/))&&this._Listener.avoidStylingTagsAndAttributes(),this._Listener.beforeParsing(a)},WYMeditor.XhtmlParser.prototype.afterParsing=function(a){return this._Listener._avoiding_tags_implicitly&&this._Listener.allowStylingTagsAndAttributes(),this._Listener.afterParsing(a)},WYMeditor.XhtmlParser.prototype.Ignore=function(){return!0},WYMeditor.XhtmlParser.prototype.Text=function(a){return this._Listener.addContent(a),!0},WYMeditor.XhtmlParser.prototype.Comment=function(a,b){return this._addNonTagBlock(a,b,"addComment")},WYMeditor.XhtmlParser.prototype.Script=function(a,b){return this._addNonTagBlock(a,b,"addScript")},WYMeditor.XhtmlParser.prototype.Css=function(a,b){return this._addNonTagBlock(a,b,"addCss")},WYMeditor.XhtmlParser.prototype._addNonTagBlock=function(a,b,c){switch(b){case WYMeditor.LEXER_ENTER:this._non_tag=a;break;case WYMeditor.LEXER_UNMATCHED:this._non_tag+=a;break;case WYMeditor.LEXER_EXIT:switch(c){case"addComment":this._Listener.addComment(this._non_tag+a);break;case"addScript":this._Listener.addScript(this._non_tag+a);break;case"addCss":this._Listener.addCss(this._non_tag+a)}}return!0},WYMeditor.XhtmlParser.prototype.SelfClosingTag=function(a,b){this.OpeningTag(a,b),this.normalizeTag(a);return this.ClosingTag(a,b)},WYMeditor.XhtmlParser.prototype.OpeningTag=function(a,b){switch(b){case WYMeditor.LEXER_ENTER:this._tag=this.normalizeTag(a),this._tag_attributes={};break;case WYMeditor.LEXER_SPECIAL:this._callOpenTagListener(this.normalizeTag(a));break;case WYMeditor.LEXER_EXIT:this._callOpenTagListener(this._tag,this._tag_attributes)}return!0},WYMeditor.XhtmlParser.prototype.ClosingTag=function(a){return this._callCloseTagListener(this.normalizeTag(a)),!0},WYMeditor.XhtmlParser.prototype._callOpenTagListener=function(a,b){b=b||{},this.autoCloseUnclosedBeforeNewOpening(a),this._Listener.isBlockTag(a)?(this._Listener._tag_stack.push(a),this._Listener.fixNestingBeforeOpeningBlockTag(a,b),this._Listener.openBlockTag(a,b),this._increaseOpenTagCounter(a)):this._Listener.isInlineTag(a)?this._Listener.inlineTag(a,b):(this._Listener.openUnknownTag(a,b),this._increaseOpenTagCounter(a)),this._Listener.last_tag=a,this._Listener.last_tag_opened=!0,this._Listener.last_tag_attributes=b},WYMeditor.XhtmlParser.prototype._callCloseTagListener=function(a){if(this._decreaseOpenTagCounter(a)){if(this.autoCloseUnclosedBeforeTagClosing(a),this._Listener.isBlockTag(a)){var b=this._Listener._tag_stack.pop();if(b===!1)return;if(b!==a){if(this._Listener._extraBlockClosingTags)return this._Listener._tag_stack.push(b),this._Listener.removedExtraBlockClosingTag(),void 0;a=b}this._Listener.closeBlockTag(a)}}else this._Listener.isInlineTag(a)||this._Listener.closeUnopenedTag(a);this._Listener.last_tag=a,this._Listener.last_tag_opened=!1},WYMeditor.XhtmlParser.prototype._increaseOpenTagCounter=function(a){this._Listener._open_tags[a]=this._Listener._open_tags[a]||0,this._Listener._open_tags[a]++},WYMeditor.XhtmlParser.prototype._decreaseOpenTagCounter=function(a){return this._Listener._open_tags[a]?(this._Listener._open_tags[a]--,0===this._Listener._open_tags[a]&&(this._Listener._open_tags[a]=void 0),!0):!1},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeNewOpening=function(a){this._autoCloseUnclosed(a,!1)},WYMeditor.XhtmlParser.prototype.autoCloseUnclosedBeforeTagClosing=function(a){this._autoCloseUnclosed(a,!0)},WYMeditor.XhtmlParser.prototype._autoCloseUnclosed=function(a,b){if(b=b||!1,this._Listener._open_tags)for(var c in this._Listener._open_tags){var d=this._Listener._open_tags[c];d>0&&this._Listener.shouldCloseTagAutomatically(c,a,b)&&this._callCloseTagListener(c,!0)}},WYMeditor.XhtmlParser.prototype.getTagReplacements=function(){return this._Listener.getTagReplacements()},WYMeditor.XhtmlParser.prototype.normalizeTag=function(a){a=a.replace(/^([\s<\/>]*)|([\s<\/>]*)$/gm,"").toLowerCase();var b=this._Listener.getTagReplacements();return b[a]?b[a]:a},WYMeditor.XhtmlParser.prototype.TagAttributes=function(a,b){return WYMeditor.LEXER_SPECIAL==b&&(this._current_attribute=a),!0},WYMeditor.XhtmlParser.prototype.DoubleQuotedAttribute=function(a,b){return WYMeditor.LEXER_UNMATCHED==b&&(this._tag_attributes[this._current_attribute]=a),!0},WYMeditor.XhtmlParser.prototype.SingleQuotedAttribute=function(a,b){return WYMeditor.LEXER_UNMATCHED==b&&(this._tag_attributes[this._current_attribute]=a),!0},WYMeditor.XhtmlParser.prototype.UnquotedAttribute=function(a){return this._tag_attributes[this._current_attribute]=a.replace(/^=/,""),!0},WYMeditor.XhtmlSaxListener=function(){return this.output="",this.helper=new WYMeditor.XmlHelper,this._open_tags={},this.validator=WYMeditor.XhtmlValidator,this._tag_stack=[],this.avoided_tags=[],this._insert_before_closing=[],this._insert_after_closing=[],this._last_node_was_text=!1,this._lastAddedOpenTag="",this._insideLI=!1,this.tagsToUnwrapInLists=WYMeditor.DocumentStructureManager.VALID_DEFAULT_ROOT_CONTAINERS,this._rootInlineTagsToRemove=["br"],this._extraBlockClosingTags=0,this._insideTagToRemove=!1,this._addSpacerBeforeElementInLI=!1,this._insideTagToRemove=!1,this._lastTagRemoved=!1,this._extraLIClosingTags=0,this._removedTagStackIndex=0,this.entities={"&nbsp;":"&#160;","&iexcl;":"&#161;","&cent;":"&#162;","&pound;":"&#163;","&curren;":"&#164;","&yen;":"&#165;","&brvbar;":"&#166;","&sect;":"&#167;","&uml;":"&#168;","&copy;":"&#169;","&ordf;":"&#170;","&laquo;":"&#171;","&not;":"&#172;","&shy;":"&#173;","&reg;":"&#174;","&macr;":"&#175;","&deg;":"&#176;","&plusmn;":"&#177;","&sup2;":"&#178;","&sup3;":"&#179;","&acute;":"&#180;","&micro;":"&#181;","&para;":"&#182;","&middot;":"&#183;","&cedil;":"&#184;","&sup1;":"&#185;","&ordm;":"&#186;","&raquo;":"&#187;","&frac14;":"&#188;","&frac12;":"&#189;","&frac34;":"&#190;","&iquest;":"&#191;","&Agrave;":"&#192;","&Aacute;":"&#193;","&Acirc;":"&#194;","&Atilde;":"&#195;","&Auml;":"&#196;","&Aring;":"&#197;","&AElig;":"&#198;","&Ccedil;":"&#199;","&Egrave;":"&#200;","&Eacute;":"&#201;","&Ecirc;":"&#202;","&Euml;":"&#203;","&Igrave;":"&#204;","&Iacute;":"&#205;","&Icirc;":"&#206;","&Iuml;":"&#207;","&ETH;":"&#208;","&Ntilde;":"&#209;","&Ograve;":"&#210;","&Oacute;":"&#211;","&Ocirc;":"&#212;","&Otilde;":"&#213;","&Ouml;":"&#214;","&times;":"&#215;","&Oslash;":"&#216;","&Ugrave;":"&#217;","&Uacute;":"&#218;","&Ucirc;":"&#219;","&Uuml;":"&#220;","&Yacute;":"&#221;","&THORN;":"&#222;","&szlig;":"&#223;","&agrave;":"&#224;","&aacute;":"&#225;","&acirc;":"&#226;","&atilde;":"&#227;","&auml;":"&#228;","&aring;":"&#229;","&aelig;":"&#230;","&ccedil;":"&#231;","&egrave;":"&#232;","&eacute;":"&#233;","&ecirc;":"&#234;","&euml;":"&#235;","&igrave;":"&#236;","&iacute;":"&#237;","&icirc;":"&#238;","&iuml;":"&#239;","&eth;":"&#240;","&ntilde;":"&#241;","&ograve;":"&#242;","&oacute;":"&#243;","&ocirc;":"&#244;","&otilde;":"&#245;","&ouml;":"&#246;","&divide;":"&#247;","&oslash;":"&#248;","&ugrave;":"&#249;","&uacute;":"&#250;","&ucirc;":"&#251;","&uuml;":"&#252;","&yacute;":"&#253;","&thorn;":"&#254;","&yuml;":"&#255;","&OElig;":"&#338;","&oelig;":"&#339;","&Scaron;":"&#352;","&scaron;":"&#353;","&Yuml;":"&#376;","&fnof;":"&#402;","&circ;":"&#710;","&tilde;":"&#732;","&Alpha;":"&#913;","&Beta;":"&#914;","&Gamma;":"&#915;","&Delta;":"&#916;","&Epsilon;":"&#917;","&Zeta;":"&#918;","&Eta;":"&#919;","&Theta;":"&#920;","&Iota;":"&#921;","&Kappa;":"&#922;","&Lambda;":"&#923;","&Mu;":"&#924;","&Nu;":"&#925;","&Xi;":"&#926;","&Omicron;":"&#927;","&Pi;":"&#928;","&Rho;":"&#929;","&Sigma;":"&#931;","&Tau;":"&#932;","&Upsilon;":"&#933;","&Phi;":"&#934;","&Chi;":"&#935;","&Psi;":"&#936;","&Omega;":"&#937;","&alpha;":"&#945;","&beta;":"&#946;","&gamma;":"&#947;","&delta;":"&#948;","&epsilon;":"&#949;","&zeta;":"&#950;","&eta;":"&#951;","&theta;":"&#952;","&iota;":"&#953;","&kappa;":"&#954;","&lambda;":"&#955;","&mu;":"&#956;","&nu;":"&#957;","&xi;":"&#958;","&omicron;":"&#959;","&pi;":"&#960;","&rho;":"&#961;","&sigmaf;":"&#962;","&sigma;":"&#963;","&tau;":"&#964;","&upsilon;":"&#965;","&phi;":"&#966;","&chi;":"&#967;","&psi;":"&#968;","&omega;":"&#969;","&thetasym;":"&#977;","&upsih;":"&#978;","&piv;":"&#982;","&ensp;":"&#8194;","&emsp;":"&#8195;","&thinsp;":"&#8201;","&zwnj;":"&#8204;","&zwj;":"&#8205;","&lrm;":"&#8206;","&rlm;":"&#8207;","&ndash;":"&#8211;","&mdash;":"&#8212;","&lsquo;":"&#8216;","&rsquo;":"&#8217;","&sbquo;":"&#8218;","&ldquo;":"&#8220;","&rdquo;":"&#8221;","&bdquo;":"&#8222;","&dagger;":"&#8224;","&Dagger;":"&#8225;","&bull;":"&#8226;","&hellip;":"&#8230;","&permil;":"&#8240;","&prime;":"&#8242;","&Prime;":"&#8243;","&lsaquo;":"&#8249;","&rsaquo;":"&#8250;","&oline;":"&#8254;","&frasl;":"&#8260;","&euro;":"&#8364;","&image;":"&#8465;","&weierp;":"&#8472;","&real;":"&#8476;","&trade;":"&#8482;","&alefsym;":"&#8501;","&larr;":"&#8592;","&uarr;":"&#8593;","&rarr;":"&#8594;","&darr;":"&#8595;","&harr;":"&#8596;","&crarr;":"&#8629;","&lArr;":"&#8656;","&uArr;":"&#8657;","&rArr;":"&#8658;","&dArr;":"&#8659;","&hArr;":"&#8660;","&forall;":"&#8704;","&part;":"&#8706;","&exist;":"&#8707;","&empty;":"&#8709;","&nabla;":"&#8711;","&isin;":"&#8712;","&notin;":"&#8713;","&ni;":"&#8715;","&prod;":"&#8719;","&sum;":"&#8721;","&minus;":"&#8722;","&lowast;":"&#8727;","&radic;":"&#8730;","&prop;":"&#8733;","&infin;":"&#8734;","&ang;":"&#8736;","&and;":"&#8743;","&or;":"&#8744;","&cap;":"&#8745;","&cup;":"&#8746;","&int;":"&#8747;","&there4;":"&#8756;","&sim;":"&#8764;","&cong;":"&#8773;","&asymp;":"&#8776;","&ne;":"&#8800;","&equiv;":"&#8801;","&le;":"&#8804;","&ge;":"&#8805;","&sub;":"&#8834;","&sup;":"&#8835;","&nsub;":"&#8836;","&sube;":"&#8838;","&supe;":"&#8839;","&oplus;":"&#8853;","&otimes;":"&#8855;","&perp;":"&#8869;","&sdot;":"&#8901;","&lceil;":"&#8968;","&rceil;":"&#8969;","&lfloor;":"&#8970;","&rfloor;":"&#8971;","&lang;":"&#9001;","&rang;":"&#9002;","&loz;":"&#9674;","&spades;":"&#9824;","&clubs;":"&#9827;","&hearts;":"&#9829;","&diams;":"&#9830;"},this.block_tags=["a","abbr","acronym","address","area","b","base","bdo","big","blockquote","body","button","caption","cite","code","colgroup","dd","del","div","dfn","dl","dt","em","fieldset","form","head","h1","h2","h3","h4","h5","h6","html","i","iframe","ins","kbd","label","legend","li","map","noscript","object","ol","optgroup","option","p","param","pre","q","samp","script","select","small","span","strong","style","sub","sup","table","tbody","td","textarea","tfoot","th","thead","title","tr","tt","ul","var","extends"],this.inline_tags=["br","col","hr","img","input"],this},WYMeditor.XhtmlSaxListener.prototype.shouldCloseTagAutomatically=function(a,b,c){if(c=c||!1,"td"==a){if(c&&"tr"==b||!c&&"td"==b)return!0}else if("option"==a&&(c&&"select"==b||!c&&"option"==b))return!0;return!1},WYMeditor.XhtmlSaxListener.prototype.beforeParsing=function(a){return this.output="",this._insert_before_closing=[],this._insert_after_closing=[],this._open_tags={},this._tag_stack=[],this._last_node_was_text=!1,this._lastTagRemoved=!1,this._insideTagToRemove=!1,this.last_tag=null,a},WYMeditor.XhtmlSaxListener.prototype.afterParsing=function(a){return a=this.replaceNamedEntities(a),a=this.joinRepeatedEntities(a),a=this.removeEmptyTags(a),a=this.removeBrInPre(a)},WYMeditor.XhtmlSaxListener.prototype.replaceNamedEntities=function(a){for(var b in this.entities)a=a.replace(new RegExp(b,"g"),this.entities[b]);return a},WYMeditor.XhtmlSaxListener.prototype.joinRepeatedEntities=function(a){var b="em|strong|sub|sup|acronym|pre|del|address";return a.replace(new RegExp("</("+b+")><\\1>",""),"").replace(new RegExp("(s*<("+b+")>s*){2}(.*)(s*</\\2>s*){2}",""),"<$2>$3<$2>")},WYMeditor.XhtmlSaxListener.prototype.removeEmptyTags=function(a){return a.replace(new RegExp("<("+this.block_tags.join("|").replace(/\|td/,"").replace(/\|th/,"")+")>(<br />|&#160;|&nbsp;|\\s)*</\\1>","g"),"")},WYMeditor.XhtmlSaxListener.prototype.removeBrInPre=function(a){var b=a.match(new RegExp("<pre[^>]*>(.*?)</pre>","gmi"));if(b)for(var c=0;c<b.length;c++)a=a.replace(b[c],b[c].replace(new RegExp("<br />","g"),String.fromCharCode(13,10)));return a},WYMeditor.XhtmlSaxListener.prototype.getResult=function(){return this.output},WYMeditor.XhtmlSaxListener.prototype.getTagReplacements=function(){return{b:"strong",i:"em"}},WYMeditor.XhtmlSaxListener.prototype.getTagForStyle=function(a){return/sub/.test(a)?"sub":/super/.test(a)?"sup":/bold/.test(a)?"strong":/italic/.test(a)?"em":!1},WYMeditor.XhtmlSaxListener.prototype.addContent=function(a){this.last_tag&&"li"==this.last_tag&&(a=a.replace(/(\r|\n|\r\n)+$/g,""),a=a.replace(/(\r|\n|\r\n)+/g," ")),a.replace(/^\s+|\s+$/g,"").length>0&&(this._last_node_was_text=!0,this._addSpacerBeforeElementInLI&&(this.output+="<br />",this._addSpacerBeforeElementInLI=!1)),this._insideTagToRemove||(this.output+=a)},WYMeditor.XhtmlSaxListener.prototype.addComment=function(a){this.remove_comments||this._insideTagToRemove||(this.output+=a)},WYMeditor.XhtmlSaxListener.prototype.addScript=function(a){this.remove_scripts||this._insideTagToRemove||(this.output+=a)},WYMeditor.XhtmlSaxListener.prototype.addCss=function(a){this.remove_embeded_styles||this._insideTagToRemove||(this.output+=a)},WYMeditor.XhtmlSaxListener.prototype.openBlockTag=function(a,b){var c=this._last_node_was_text;if(this._last_node_was_text=!1,!this._insideTagToRemove){if(this._shouldRemoveTag(a,b))return this._insideTagToRemove=!0,this._removedTagStackIndex=this._tag_stack.length-1,void 0;if(this._insideLI&&jQuery.inArray(a,this.tagsToUnwrapInLists)>-1)return("li"!==this._lastAddedOpenTag||c)&&(this.output+="<br />",this._addSpacerBeforeElementInLI=!1),this._tag_stack.pop(),this._extraBlockClosingTags++,void 0;if(this._addSpacerBeforeElementInLI&&"li"!==a&&-1===jQuery.inArray(a,WYMeditor.LIST_TYPE_ELEMENTS)&&(this.output+="<br />",this._addSpacerBeforeElementInLI=!1),b=this.validator.getValidTagAttributes(a,b),b=this.removeUnwantedClasses(b),"span"===a&&b.style){var d=this.getTagForStyle(b.style);d&&(a=d,this._tag_stack.pop(),this._tag_stack.push(a),b.style="")}"li"===a&&(this._insideLI=!0,this._addSpacerBeforeElementInLI=!1),this.output+=this.helper.tag(a,b,!0),this._lastAddedOpenTag=a,this._lastTagRemoved=!1}},WYMeditor.XhtmlSaxListener.prototype.inlineTag=function(a,b){this._insideTagToRemove||this._shouldRemoveTag(a,b)||(this._last_node_was_text=!1,b=this.validator.getValidTagAttributes(a,b),b=this.removeUnwantedClasses(b),this.output+=this.helper.tag(a,b),this._lastTagRemoved=!1)},WYMeditor.XhtmlSaxListener.prototype.openUnknownTag=function(){},WYMeditor.XhtmlSaxListener.prototype.closeBlockTag=function(a){return this._last_node_was_text=!1,this._insideTagToRemove?(this._tag_stack.length===this._removedTagStackIndex&&(this._insideTagToRemove=!1),this._lastTagRemoved=!0,void 0):("li"===a&&(this._insideLI=!1,this._addSpacerBeforeElementInLI=!1),jQuery.inArray(a,WYMeditor.LIST_TYPE_ELEMENTS)>-1&&(this._insideLI=!1),this.output=this.output.replace(/<br \/>$/,"")+this._getClosingTagContent("before",a)+"</"+a+">"+this._getClosingTagContent("after",a),void 0)},WYMeditor.XhtmlSaxListener.prototype.removedExtraBlockClosingTag=function(){this._extraBlockClosingTags--,this._addSpacerBeforeElementInLI=!0,this._last_node_was_text=!1},WYMeditor.XhtmlSaxListener.prototype.closeUnknownTag=function(){},WYMeditor.XhtmlSaxListener.prototype.closeUnopenedTag=function(a){this._last_node_was_text=!1,this._insideTagToRemove||("li"===a&&this._extraLIClosingTags?this._extraLIClosingTags--:this.output+="</"+a+">")},WYMeditor.XhtmlSaxListener.prototype.avoidStylingTagsAndAttributes=function(){this.avoided_tags=["div","span"],this.validator.skiped_attributes=["style"],this.validator.skiped_attribute_values=["MsoNormal","main1"],this._avoiding_tags_implicitly=!0},WYMeditor.XhtmlSaxListener.prototype.allowStylingTagsAndAttributes=function(){this.avoided_tags=[],this.validator.skiped_attributes=[],this.validator.skiped_attribute_values=[],this._avoiding_tags_implicitly=!1},WYMeditor.XhtmlSaxListener.prototype.isBlockTag=function(a){return!WYMeditor.Helper.contains(this.avoided_tags,a)&&WYMeditor.Helper.contains(this.block_tags,a)},WYMeditor.XhtmlSaxListener.prototype.isInlineTag=function(a){return!WYMeditor.Helper.contains(this.avoided_tags,a)&&WYMeditor.Helper.contains(this.inline_tags,a)},WYMeditor.XhtmlSaxListener.prototype.insertContentAfterClosingTag=function(a,b){this._insertContentWhenClosingTag("after",a,b)},WYMeditor.XhtmlSaxListener.prototype.insertContentBeforeClosingTag=function(a,b){this._insertContentWhenClosingTag("before",a,b)},WYMeditor.XhtmlSaxListener.prototype.removeUnwantedClasses=function(a){var b,c;if(!a["class"])return a;for(c=0;c<WYMeditor.CLASSES_REMOVED_BY_PARSER.length;++c)b=new RegExp("(^|\\s)"+WYMeditor.CLASSES_REMOVED_BY_PARSER[c]+"($|\\s)","gi"),a["class"]=a["class"].replace(b,"$1");return a["class"]=a["class"].replace(/\s$/,""),a},WYMeditor.XhtmlSaxListener.prototype.fixNestingBeforeOpeningBlockTag=function(a,b){if(this._last_node_was_text||"ul"!=a&&"ol"!=a||!this.last_tag||this.last_tag_opened||"li"!=this.last_tag)if("ul"!=a&&"ol"!=a||!this.last_tag||!this.last_tag_opened||"ul"!=this.last_tag&&"ol"!=this.last_tag){if("li"==a&&this._tag_stack.length>=2){var c=this._tag_stack[this._tag_stack.length-2];"li"!=c||this._shouldRemoveTag(a,b)||(this._open_tags.li-=1,0===this._open_tags.li&&(this._open_tags.li=void 0),this._tag_stack.splice(this._tag_stack.length-2,1),this._last_node_was_text=!1,this._insideTagToRemove?this._tag_stack.length-1===this._removedTagStackIndex&&(this._insideTagToRemove=!1,this._lastTagRemoved=!0,this._extraLIClosingTags++):this.output+="</li>")}}else this._shouldRemoveTag(a,b)||(this.output+=this.helper.tag("li",{},!0),this.insertContentAfterClosingTag(a,"</li>")),this._last_node_was_text=!1;else this._lastTagRemoved?(this._insideTagToRemove=!0,this._removedTagStackIndex=this._tag_stack.length-1):this._shouldRemoveTag(a,b)||(this.output=this.output.replace(/<\/li>\s*$/,""),this.insertContentAfterClosingTag(a,"</li>"))},WYMeditor.XhtmlSaxListener.prototype._insertContentWhenClosingTag=function(a,b,c){this["_insert_"+a+"_closing"]||(this["_insert_"+a+"_closing"]=[]),this["_insert_"+a+"_closing"][b]||(this["_insert_"+a+"_closing"][b]=[]),this["_insert_"+a+"_closing"][b].push(c)},WYMeditor.XhtmlSaxListener.prototype._getClosingTagContent=function(a,b){return this["_insert_"+a+"_closing"]&&this["_insert_"+a+"_closing"][b]&&this["_insert_"+a+"_closing"][b].length>0?this["_insert_"+a+"_closing"][b].pop():""},WYMeditor.XhtmlSaxListener.prototype._shouldRemoveTag=function(a,b){return this._isEditorOnlyTag(a,b)?!0:this._isRootInlineTagToRemove(a,b,this._tag_stack)?!0:!1},WYMeditor.XhtmlSaxListener.prototype._isEditorOnlyTag=function(a,b){var c;return b["class"]?(c=b["class"].split(" "),WYMeditor.Helper.contains(c,WYMeditor.EDITOR_ONLY_CLASS)?!0:!1):!1},WYMeditor.XhtmlSaxListener.prototype._isRootInlineTagToRemove=function(a,b,c){return this.isInlineTag(a)?c.length>0?!1:WYMeditor.Helper.contains(this._rootInlineTagsToRemove,a)?!0:!1:!1},WYMeditor.XhtmlValidator={_attributes:{core:{except:["base","head","html","meta","param","script","style","title"],attributes:["class","id","style","title","accesskey","tabindex","/^data-.*/"]},language:{except:["base","br","hr","iframe","param","script"],attributes:{dir:["ltr","rtl"],0:"lang",1:"xml:lang"}},keyboard:{attributes:{accesskey:/^(\w){1}$/,tabindex:/^(\d)+$/}}},_events:{window:{only:["body"],attributes:["onload","onunload"]},form:{only:["form","input","textarea","select","a","label","button"],attributes:["onchange","onsubmit","onreset","onselect","onblur","onfocus"]},keyboard:{except:["base","bdo","br","frame","frameset","head","html","iframe","meta","param","script","style","title"],attributes:["onkeydown","onkeypress","onkeyup"]},mouse:{except:["base","bdo","br","head","html","meta","param","script","style","title"],attributes:["onclick","ondblclick","onmousedown","onmousemove","onmouseover","onmouseout","onmouseup"]}},_tags:{a:{attributes:{0:"charset",1:"coords",2:"href",3:"hreflang",4:"name",5:"rel",6:"rev",shape:/^(rect|rectangle|circ|circle|poly|polygon)$/,7:"type"}},0:"abbr",1:"acronym",2:"address",area:{attributes:{0:"alt",1:"coords",2:"href",nohref:/^(true|false)$/,shape:/^(rect|rectangle|circ|circle|poly|polygon)$/},required:["alt"]},3:"b",base:{attributes:["href"],required:["href"]},bdo:{attributes:{dir:/^(ltr|rtl)$/},required:["dir"]},4:"big",blockquote:{attributes:["cite"]},5:"body",6:"br",button:{attributes:{disabled:/^(disabled)$/,type:/^(button|reset|submit)$/,0:"value"},inside:"form"},7:"caption",8:"cite",9:"code",col:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"},inside:"colgroup"},colgroup:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",span:/^(\d)+$/,valign:/^(top|middle|bottom|baseline)$/,2:"width"}},10:"dd",del:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},11:"div",12:"dfn",13:"dl",14:"dt",15:"em",fieldset:{inside:"form"},form:{attributes:{0:"action",1:"accept",2:"accept-charset",3:"enctype",method:/^(get|post)$/},required:["action"]},head:{attributes:["profile"]},16:"h1",17:"h2",18:"h3",19:"h4",20:"h5",21:"h6",22:"hr",html:{attributes:["xmlns"]},23:"i",img:{attributes:["alt","src","height","ismap","longdesc","usemap","width"],required:["alt","src"]},input:{attributes:{0:"accept",1:"alt",checked:/^(checked)$/,disabled:/^(disabled)$/,maxlength:/^(\d)+$/,2:"name",readonly:/^(readonly)$/,size:/^(\d)+$/,3:"src",type:/^(button|checkbox|file|hidden|image|password|radio|reset|submit|text)$/,4:"value"},inside:"form"},ins:{attributes:{0:"cite",datetime:/^([0-9]){8}/}},24:"kbd",label:{attributes:["for"],inside:"form"},25:"legend",26:"li",link:{attributes:{0:"charset",1:"href",2:"hreflang",media:/^(all|braille|print|projection|screen|speech|,|;| )+$/i,rel:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,rev:/^(alternate|appendix|bookmark|chapter|contents|copyright|glossary|help|home|index|next|prev|section|start|stylesheet|subsection| |shortcut|icon)+$/i,3:"type"},inside:"head"},map:{attributes:["id","name"],required:["id"]},meta:{attributes:{0:"content","http-equiv":/^(content\-type|expires|refresh|set\-cookie)$/i,1:"name",2:"scheme"},required:["content"]},27:"noscript",object:{attributes:["archive","classid","codebase","codetype","data","declare","height","name","standby","type","usemap","width"]},28:"ol",optgroup:{attributes:{0:"label",disabled:/^(disabled)$/},required:["label"]},option:{attributes:{0:"label",disabled:/^(disabled)$/,selected:/^(selected)$/,1:"value"},inside:"select"},29:"p",param:{attributes:{0:"type",valuetype:/^(data|ref|object)$/,1:"valuetype",2:"value"},required:["name"]},30:"pre",q:{attributes:["cite"]},31:"samp",script:{attributes:{type:/^(text\/ecmascript|text\/javascript|text\/jscript|text\/vbscript|text\/vbs|text\/xml)$/,0:"charset",defer:/^(defer)$/,1:"src"},required:["type"]},select:{attributes:{disabled:/^(disabled)$/,multiple:/^(multiple)$/,0:"name",1:"size"},inside:"form"},32:"small",33:"span",34:"strong",style:{attributes:{0:"type",media:/^(screen|tty|tv|projection|handheld|print|braille|aural|all)$/},required:["type"]},35:"sub",36:"sup",table:{attributes:{0:"border",1:"cellpadding",2:"cellspacing",frame:/^(void|above|below|hsides|lhs|rhs|vsides|box|border)$/,rules:/^(none|groups|rows|cols|all)$/,3:"summary",4:"width"}},tbody:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},td:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},textarea:{attributes:["cols","rows","disabled","name","readonly"],required:["cols","rows"],inside:"form"},tfoot:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom)$/,2:"baseline"}},th:{attributes:{0:"abbr",align:/^(left|right|center|justify|char)$/,1:"axis",2:"char",3:"charoff",colspan:/^(\d)+$/,4:"headers",rowspan:/^(\d)+$/,scope:/^(col|colgroup|row|rowgroup)$/,valign:/^(top|middle|bottom|baseline)$/}},thead:{attributes:{align:/^(right|left|center|justify)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},37:"title",tr:{attributes:{align:/^(right|left|center|justify|char)$/,0:"char",1:"charoff",valign:/^(top|middle|bottom|baseline)$/}},38:"tt",39:"ul",40:"var"},skiped_attributes:[],skiped_attribute_values:[],getValidTagAttributes:function(a,b){var c={},d=this.getPossibleTagAttributes(a);for(var e in b){var f=b[e];e=e.toLowerCase();var g=WYMeditor.Helper;g.contains(this.skiped_attributes,e)||g.contains(this.skiped_attribute_values,f)||("function"!=typeof f&&g.contains(d,e)?this.doesAttributeNeedsValidation(a,e)?this.validateAttribute(a,e,f)&&(c[e]=f):c[e]=f:jQuery.each(d,function(){this.match(/\/(.*)\//)&&(regex=new RegExp(this.match(/\/(.*)\//)[1]),regex.test(e)&&(c[e]=f))
}))}return c},getUniqueAttributesAndEventsForTag:function(a){var b=[];if(this._tags[a]&&this._tags[a].attributes)for(var c in this._tags[a].attributes)b.push(parseInt(c,10)==c?this._tags[a].attributes[c]:c);return b},getDefaultAttributesAndEventsForTags:function(){var a=[];for(var b in this._events)a.push(this._events[b]);for(b in this._attributes)a.push(this._attributes[b]);return a},isValidTag:function(a){if(this._tags[a])return!0;for(var b in this._tags)if(this._tags[b]==a)return!0;return!1},getDefaultAttributesAndEventsForTag:function(a){var b=[];if(this.isValidTag(a)){var c=this.getDefaultAttributesAndEventsForTags();for(var d in c){var e=c[d];if("object"==typeof e){var f=WYMeditor.Helper;if(e.except&&f.contains(e.except,a)||e.only&&!f.contains(e.only,a))continue;var g=e.attributes?e.attributes:e.events;for(var h in g)b.push("string"!=typeof g[h]?h:g[h])}}}return b},doesAttributeNeedsValidation:function(a,b){return this._tags[a]&&(this._tags[a].attributes&&this._tags[a].attributes[b]||this._tags[a].required&&WYMeditor.Helper.contains(this._tags[a].required,b))},validateAttribute:function(a,b,c){return this._tags[a]&&this._tags[a].attributes&&this._tags[a].attributes[b]&&c.length>0&&!c.match(this._tags[a].attributes[b])||this._tags[a]&&this._tags[a].required&&WYMeditor.Helper.contains(this._tags[a].required,b)&&0===c.length?!1:"undefined"!=typeof this._tags[a]},getPossibleTagAttributes:function(a){return this._possible_tag_attributes||(this._possible_tag_attributes={}),this._possible_tag_attributes[a]||(this._possible_tag_attributes[a]=this.getUniqueAttributesAndEventsForTag(a).concat(this.getDefaultAttributesAndEventsForTag(a))),this._possible_tag_attributes[a]}},WYMeditor.XmlHelper=function(){return this._entitiesDiv=document.createElement("div"),this},WYMeditor.XmlHelper.prototype.tag=function(a,b,c){return b=b||!1,c=c||!1,"<"+a+(b?this.tagOptions(b):"")+(c?">":" />")},WYMeditor.XmlHelper.prototype.contentTag=function(a,b,c){return c=c||!1,"<"+a+(c?this.tagOptions(c):"")+">"+b+"</"+a+">"},WYMeditor.XmlHelper.prototype.cdataSection=function(a){return"<![CDATA["+a+"]]>"},WYMeditor.XmlHelper.prototype.escapeOnce=function(a){return this._fixDoubleEscape(this.escapeEntities(a))},WYMeditor.XmlHelper.prototype._fixDoubleEscape=function(a){return a.replace(/&amp;([a-z]+|(#\d+));/gi,"&$1;")},WYMeditor.XmlHelper.prototype.tagOptions=function(a){var b=this;b._formated_options="";for(var c in a){var d=a[c];"function"!=typeof d&&d.length>0&&(parseInt(c,10)==c&&"object"==typeof d&&(c=d.shift(),d=d.pop()),""!==c&&""!==d&&(b._formated_options+=" "+c+'="'+b.escapeOnce(d)+'"'))}return b._formated_options},WYMeditor.XmlHelper.prototype.escapeEntities=function(a,b){this._entitiesDiv.innerHTML=a,this._entitiesDiv.textContent=a;var c=this._entitiesDiv.innerHTML;return"undefined"==typeof b&&(b!==!1&&(c=c.replace('"',"&quot;")),b===!0&&(c=c.replace('"',"&#039;"))),c},WYMeditor.XmlHelper.prototype.parseAttributes=function(a){var b=[],c=a.split(/((=\s*")(")("))|((=\s*\')(\')(\'))|((=\s*[^>\s]*))/g);if(c.toString()!=a)for(var d in c){var e=c[d];if("function"!=typeof e&&0!==e.length){var f=new RegExp("(\\w+)\\s*"+e),g=a.match(f);if(g){var h=e.replace(/^[\s=]+/,""),i=h.charAt(0);i='"'==i?'"':"'"==i?"'":"",""!==i&&(h='"'==i?h.replace(/^"|"+$/g,""):h.replace(/^'|'+$/g,"")),a=a.replace(g[0],""),b.push([g[1],h])}}}return b},window.rangy=function(){function a(a,b){var c=typeof a[b];return c==l||!(c!=k||!a[b])||"unknown"==c}function b(a,b){return!(typeof a[b]!=k||!a[b])}function c(a,b){return typeof a[b]!=m}function d(a){return function(b,c){for(var d=c.length;d--;)if(!a(b,c[d]))return!1;return!0}}function e(a){return a&&r(a,q)&&t(a,p)}function f(a){window.alert("Rangy not supported in your browser. Reason: "+a),u.initialized=!0,u.supported=!1}function g(a){var b="Rangy warning: "+a;u.config.alertOnWarn?window.alert(b):typeof window.console!=m&&typeof window.console.log!=m&&window.console.log(b)}function h(){if(!u.initialized){var c,d=!1,g=!1;a(document,"createRange")&&(c=document.createRange(),r(c,o)&&t(c,n)&&(d=!0),c.detach());var h=b(document,"body")?document.body:document.getElementsByTagName("body")[0];h&&a(h,"createTextRange")&&(c=h.createTextRange(),e(c)&&(g=!0)),d||g||f("Neither Range nor TextRange are implemented"),u.initialized=!0,u.features={implementsDomRange:d,implementsTextRange:g};for(var i=w.concat(v),j=0,k=i.length;k>j;++j)try{i[j](u)}catch(l){b(window,"console")&&a(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",l)}}}function i(a){a=a||window,h();for(var b=0,c=x.length;c>b;++b)x[b](a)}function j(a){this.name=a,this.initialized=!1,this.supported=!1}var k="object",l="function",m="undefined",n=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],p=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],q=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],r=d(a),s=d(b),t=d(c),u={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:a,isHostObject:b,isHostProperty:c,areHostMethods:r,areHostObjects:s,areHostProperties:t,isTextRange:e},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};u.fail=f,u.warn=g,{}.hasOwnProperty?u.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:f("hasOwnProperty not supported");var v=[],w=[];u.init=h,u.addInitListener=function(a){u.initialized?a(u):v.push(a)};var x=[];u.addCreateMissingNativeApiListener=function(a){x.push(a)},u.createMissingNativeApi=i,j.prototype.fail=function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},j.prototype.warn=function(a){u.warn("Module "+this.name+": "+a)},j.prototype.createError=function(a){return new Error("Error in Rangy "+this.name+" module: "+a)},u.createModule=function(a,b){var c=new j(a);u.modules[a]=c,w.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},u.requireModules=function(a){for(var b,c,d=0,e=a.length;e>d;++d){if(c=a[d],b=u.modules[c],!(b&&b instanceof j))throw new Error("Module '"+c+"' not found");if(!b.supported)throw new Error("Module '"+c+"' not supported")}};var y=!1,z=function(){y||(y=!0,u.initialized||h())};return typeof window==m?(f("No window found"),void 0):typeof document==m?(f("No document found"),void 0):(a(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",z,!1),a(window,"addEventListener")?window.addEventListener("load",z,!1):a(window,"attachEvent")?window.attachEvent("onload",z):f("Window does not have required addEventListener or attachEvent method"),u)}(),rangy.createModule("DomUtil",function(a,b){function c(a){var b;return typeof a.namespaceURI==z||null===(b=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==b}function d(a){var b=a.parentNode;return 1==b.nodeType?b:null}function e(a){for(var b=0;a=a.previousSibling;)b++;return b}function f(a){var b;return j(a)?a.length:(b=a.childNodes)?b.length:0}function g(a,b){var c,d=[];for(c=a;c;c=c.parentNode)d.push(c);for(c=b;c;c=c.parentNode)if(D(d,c))return c;return null}function h(a,b,c){for(var d=c?b:b.parentNode;d;){if(d===a)return!0;d=d.parentNode}return!1}function i(a,b,c){for(var d,e=c?a:a.parentNode;e;){if(d=e.parentNode,d===b)return e;e=d}return null}function j(a){var b=a.nodeType;return 3==b||4==b||8==b}function k(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function l(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),k(c,a),c}function m(a){if(9==a.nodeType)return a;if(typeof a.ownerDocument!=z)return a.ownerDocument;if(typeof a.document!=z)return a.document;if(a.parentNode)return m(a.parentNode);throw new Error("getDocument: no document found for node")}function n(a){var b=m(a);if(typeof b.defaultView!=z)return b.defaultView;if(typeof b.parentWindow!=z)return b.parentWindow;throw new Error("Cannot get a window object for node")}function o(a){if(typeof a.contentDocument!=z)return a.contentDocument;if(typeof a.contentWindow!=z)return a.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function p(a){if(typeof a.contentWindow!=z)return a.contentWindow;if(typeof a.contentDocument!=z)return a.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function q(a){return A.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]}function r(a){for(var b;b=a.parentNode;)a=b;return a}function s(a,b,c,d){var f,h,j,k,l;if(a==c)return b===d?0:d>b?-1:1;if(f=i(c,a,!0))return b<=e(f)?-1:1;if(f=i(a,c,!0))return e(f)<d?-1:1;if(h=g(a,c),j=a===h?h:i(a,h,!0),k=c===h?h:i(c,h,!0),j===k)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(l=h.firstChild;l;){if(l===j)return-1;if(l===k)return 1;l=l.nextSibling}throw new Error("Should not be here!")}function t(a){for(var b,c=m(a).createDocumentFragment();b=a.firstChild;)c.appendChild(b);return c}function u(a){if(!a)return"[No node]";if(j(a))return'"'+a.data+'"';if(1==a.nodeType){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+a.childNodes.length+"]"}return a.nodeName}function v(a){this.root=a,this._next=a}function w(a){return new v(a)}function x(a,b){this.node=a,this.offset=b}function y(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var z="undefined",A=a.util;A.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),A.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var B=document.createElement("div");A.areHostMethods(B,["insertBefore","appendChild","cloneNode"]||!A.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),A.isHostProperty(B,"innerHTML")||b.fail("Element is missing innerHTML property");var C=document.createTextNode("test");A.areHostMethods(C,["splitText","deleteData","insertData","appendData","cloneNode"]||!A.areHostObjects(B,["previousSibling","nextSibling","childNodes","parentNode"])||!A.areHostProperties(C,["data"]))||b.fail("Incomplete Text Node implementation");var D=function(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1};v.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a,b,c=this._current=this._next;if(this._current)if(a=c.firstChild)this._next=a;else{for(b=null;c!==this.root&&!(b=c.nextSibling);)c=c.parentNode;this._next=b}return this._current},detach:function(){this._current=this._next=this.root=null}},x.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+u(this.node)+":"+this.offset+")]"}},y.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},y.prototype.toString=function(){return this.message},a.dom={arrayContains:D,isHtmlNamespace:c,parentElement:d,getNodeIndex:e,getNodeLength:f,getCommonAncestor:g,isAncestorOf:h,getClosestAncestorIn:i,isCharacterDataNode:j,insertAfter:k,splitDataNode:l,getDocument:m,getWindow:n,getIframeWindow:p,getIframeDocument:o,getBody:q,getRootContainer:r,comparePoints:s,inspectNode:u,fragmentFromNodeChildren:t,createIterator:w,DomPosition:x},a.DOMException=y}),rangy.createModule("DomRange",function(a){function b(a,b){return 3!=a.nodeType&&(K.isAncestorOf(a,b.startContainer,!0)||K.isAncestorOf(a,b.endContainer,!0))}function c(a){return K.getDocument(a.startContainer)}function d(a,b,c){var d=a._listeners[b];if(d)for(var e=0,f=d.length;f>e;++e)d[e].call(a,{target:a,args:c})}function e(a){return new L(a.parentNode,K.getNodeIndex(a))}function f(a){return new L(a.parentNode,K.getNodeIndex(a)+1)}function g(a,b,c){var d=11==a.nodeType?a.firstChild:a;return K.isCharacterDataNode(b)?c==b.length?K.insertAfter(a,b):b.parentNode.insertBefore(a,0==c?b:K.splitDataNode(b,c)):c>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[c]),d}function h(a){for(var b,d,e,f=c(a.range).createDocumentFragment();d=a.next();){if(b=a.isPartiallySelectedSubtree(),d=d.cloneNode(!b),b&&(e=a.getSubtreeIterator(),d.appendChild(h(e)),e.detach(!0)),10==d.nodeType)throw new M("HIERARCHY_REQUEST_ERR");f.appendChild(d)}return f}function i(a,b,c){var d,e;c=c||{stop:!1};for(var f,g;f=a.next();)if(a.isPartiallySelectedSubtree()){if(b(f)===!1)return c.stop=!0,void 0;if(g=a.getSubtreeIterator(),i(g,b,c),g.detach(!0),c.stop)return}else for(d=K.createIterator(f);e=d.next();)if(b(e)===!1)return c.stop=!0,void 0}function j(a){for(var b;a.next();)a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),j(b),b.detach(!0)):a.remove()}function k(a){for(var b,d,e=c(a.range).createDocumentFragment();b=a.next();){if(a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(k(d)),d.detach(!0)):a.remove(),10==b.nodeType)throw new M("HIERARCHY_REQUEST_ERR");e.appendChild(b)}return e}function l(a,b,c){var d,e=!(!b||!b.length),f=!!c;e&&(d=new RegExp("^("+b.join("|")+")$"));var g=[];return i(new n(a,!1),function(a){e&&!d.test(a.nodeType)||f&&!c(a)||g.push(a)}),g}function m(a){var b="undefined"==typeof a.getName?"Range":a.getName();return"["+b+"("+K.inspectNode(a.startContainer)+":"+a.startOffset+", "+K.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function n(a,b){if(this.range=a,this.clonePartiallySelectedTextNodes=b,!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var c=a.commonAncestorContainer;this.sc===this.ec&&K.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==c||K.isCharacterDataNode(this.sc)?K.getClosestAncestorIn(this.sc,c,!0):this.sc.childNodes[this.so],this._last=this.ec!==c||K.isCharacterDataNode(this.ec)?K.getClosestAncestorIn(this.ec,c,!0):this.ec.childNodes[this.eo-1])}}function o(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function p(a,b,c){this.nodes=l(a,b,c),this._next=this.nodes[0],this._position=0}function q(a){return function(b,c){for(var d,e=c?b:b.parentNode;e;){if(d=e.nodeType,K.arrayContains(a,d))return e;e=e.parentNode}return null}}function r(a,b){if(V(a,b))throw new o("INVALID_NODE_TYPE_ERR")}function s(a){if(!a.startContainer)throw new M("INVALID_STATE_ERR")}function t(a,b){if(!K.arrayContains(b,a.nodeType))throw new o("INVALID_NODE_TYPE_ERR")}function u(a,b){if(0>b||b>(K.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new M("INDEX_SIZE_ERR")}function v(a,b){if(T(a,!0)!==T(b,!0))throw new M("WRONG_DOCUMENT_ERR")}function w(a){if(U(a,!0))throw new M("NO_MODIFICATION_ALLOWED_ERR")}function x(a,b){if(!a)throw new M(b)}function y(a){return!K.arrayContains(O,a.nodeType)&&!T(a,!0)}function z(a,b){return b<=(K.isCharacterDataNode(a)?a.length:a.childNodes.length)}function A(a){if(s(a),y(a.startContainer)||y(a.endContainer)||!z(a.startContainer,a.startOffset)||!z(a.endContainer,a.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function B(){}function C(a){a.START_TO_START=_,a.START_TO_END=ab,a.END_TO_END=bb,a.END_TO_START=cb,a.NODE_BEFORE=db,a.NODE_AFTER=eb,a.NODE_BEFORE_AND_AFTER=fb,a.NODE_INSIDE=gb}function D(a){C(a),C(a.prototype)}function E(a,b){return function(){A(this);var c,d,e=this.startContainer,g=this.startOffset,h=this.commonAncestorContainer,j=new n(this,!0);e!==h&&(c=K.getClosestAncestorIn(e,h,!0),d=f(c),e=d.node,g=d.offset),i(j,w),j.reset();var k=a(j);return j.detach(),b(this,e,g,e,g),k}}function F(c,d,g){function h(a,b){return function(c){s(this),t(c,N),t(S(c),O);var d=(a?e:f)(c);(b?i:l)(this,d.node,d.offset)}}function i(a,b,c){var e=a.endContainer,f=a.endOffset;(b!==a.startContainer||c!==a.startOffset)&&((S(b)!=S(e)||1==K.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,b,c,e,f))}function l(a,b,c){var e=a.startContainer,f=a.startOffset;(b!==a.endContainer||c!==a.endOffset)&&((S(b)!=S(e)||-1==K.comparePoints(b,c,e,f))&&(e=b,f=c),d(a,e,f,b,c))}function m(a,b,c){(b!==a.startContainer||c!==a.startOffset||b!==a.endContainer||c!==a.endOffset)&&d(a,b,c,b,c)}c.prototype=new B,a.util.extend(c.prototype,{setStart:function(a,b){s(this),r(a,!0),u(a,b),i(this,a,b)},setEnd:function(a,b){s(this),r(a,!0),u(a,b),l(this,a,b)},setStartBefore:h(!0,!0),setStartAfter:h(!1,!0),setEndBefore:h(!0,!1),setEndAfter:h(!1,!1),collapse:function(a){A(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){s(this),r(a,!0),d(this,a,0,a,K.getNodeLength(a))},selectNode:function(a){s(this),r(a,!1),t(a,N);var b=e(a),c=f(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:E(k,d),deleteContents:E(j,d),canSurroundContents:function(){A(this),w(this.startContainer),w(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},detach:function(){g(this)},splitBoundaries:function(){A(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=a===c;K.isCharacterDataNode(c)&&e>0&&e<c.length&&K.splitDataNode(c,e),K.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=K.splitDataNode(a,b),f?(e-=b,c=a):c==a.parentNode&&e>=K.getNodeIndex(a)&&e++,b=0),d(this,a,b,c,e)},normalizeBoundaries:function(){A(this);var a=this.startContainer,b=this.startOffset,c=this.endContainer,e=this.endOffset,f=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(c=a,e=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},g=function(d){var f=d.previousSibling;if(f&&f.nodeType==d.nodeType){a=d;var g=d.length;if(b=f.length,d.insertData(0,f.data),f.parentNode.removeChild(f),a==c)e+=b,c=a;else if(c==d.parentNode){var h=K.getNodeIndex(d);e==h?(c=d,e=g):e>h&&e--}}},h=!0;if(K.isCharacterDataNode(c))c.length==e&&f(c);else{if(e>0){var i=c.childNodes[e-1];i&&K.isCharacterDataNode(i)&&f(i)}h=!this.collapsed}if(h){if(K.isCharacterDataNode(a))0==b&&g(a);else if(b<a.childNodes.length){var j=a.childNodes[b];j&&K.isCharacterDataNode(j)&&g(j)}}else a=c,b=e;d(this,a,b,c,e)},collapseToPoint:function(a,b){s(this),r(a,!0),u(a,b),m(this,a,b)}}),D(c)}function G(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:K.getCommonAncestor(a.startContainer,a.endContainer)}function H(a,b,c,e,f){var g=a.startContainer!==b||a.startOffset!==c,h=a.endContainer!==e||a.endOffset!==f;a.startContainer=b,a.startOffset=c,a.endContainer=e,a.endOffset=f,G(a),d(a,"boundarychange",{startMoved:g,endMoved:h})}function I(a){s(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null,d(a,"detach",null),a._listeners=null}function J(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},G(this)}a.requireModules(["DomUtil"]);var K=a.dom,L=K.DomPosition,M=a.DOMException;n.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,K.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a,b,c=this._current;!K.isCharacterDataNode(c)||c!==this.sc&&c!==this.ec?c.parentNode&&c.parentNode.removeChild(c):(a=c===this.sc?this.so:0,b=c===this.ec?this.eo:c.length,a!=b&&c.deleteData(a,b-a))},isPartiallySelectedSubtree:function(){var a=this._current;return b(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new J(c(this.range));var b=this._current,d=b,e=0,f=b,g=K.getNodeLength(b);K.isAncestorOf(b,this.sc,!0)&&(d=this.sc,e=this.so),K.isAncestorOf(b,this.ec,!0)&&(f=this.ec,g=this.eo),H(a,d,e,f,g)}return new n(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},o.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},o.prototype.toString=function(){return this.message},p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var N=[1,3,4,5,7,8,10],O=[2,9,11],P=[5,6,10,12],Q=[1,3,4,5,7,8,10,11],R=[1,3,4,5,7,8],S=K.getRootContainer,T=q([9,11]),U=q(P),V=q([6,10,12]),W=document.createElement("style"),X=!1;try{W.innerHTML="<b>x</b>",X=3==W.firstChild.nodeType}catch(Y){}a.features.htmlParsingConforms=X;var Z=X?function(a){var b=this.startContainer,c=K.getDocument(b);if(!b)throw new M("INVALID_STATE_ERR");var d=null;return 1==b.nodeType?d=b:K.isCharacterDataNode(b)&&(d=K.parentElement(b)),d=null===d||"HTML"==d.nodeName&&K.isHtmlNamespace(K.getDocument(d).documentElement)&&K.isHtmlNamespace(d)?c.createElement("body"):d.cloneNode(!1),d.innerHTML=a,K.fragmentFromNodeChildren(d)}:function(a){s(this);var b=c(this),d=b.createElement("body");return d.innerHTML=a,K.fragmentFromNodeChildren(d)},$=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],_=0,ab=1,bb=2,cb=3,db=0,eb=1,fb=2,gb=3;B.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){A(this),v(this.startContainer,b.startContainer);var c,d,e,f,g=a==cb||a==_?"start":"end",h=a==ab||a==_?"start":"end";return c=this[g+"Container"],d=this[g+"Offset"],e=b[h+"Container"],f=b[h+"Offset"],K.comparePoints(c,d,e,f)},insertNode:function(a){if(A(this),t(a,Q),w(this.startContainer),K.isAncestorOf(a,this.startContainer,!0))throw new M("HIERARCHY_REQUEST_ERR");var b=g(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){A(this);var a,b;if(this.collapsed)return c(this).createDocumentFragment();if(this.startContainer===this.endContainer&&K.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=c(this).createDocumentFragment(),b.appendChild(a),b;var d=new n(this,!0);return a=h(d),d.detach(),a},canSurroundContents:function(){A(this),w(this.startContainer),w(this.endContainer);var a=new n(this,!0),c=a._first&&b(a._first,this)||a._last&&b(a._last,this);return a.detach(),!c},surroundContents:function(a){if(t(a,R),!this.canSurroundContents())throw new o("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);g(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){A(this);for(var a,b=new J(c(this)),d=$.length;d--;)a=$[d],b[a]=this[a];return b},toString:function(){A(this);var a=this.startContainer;if(a===this.endContainer&&K.isCharacterDataNode(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var b=[],c=new n(this,!0);return i(c,function(a){(3==a.nodeType||4==a.nodeType)&&b.push(a.data)}),c.detach(),b.join("")},compareNode:function(a){A(this);var b=a.parentNode,c=K.getNodeIndex(a);if(!b)throw new M("NOT_FOUND_ERR");var d=this.comparePoint(b,c),e=this.comparePoint(b,c+1);return 0>d?e>0?fb:db:e>0?eb:gb},comparePoint:function(a,b){return A(this),x(a,"HIERARCHY_REQUEST_ERR"),v(a,this.startContainer),K.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:K.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Z,toHtml:function(){A(this);var a=c(this).createElement("div");return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){if(A(this),x(a,"NOT_FOUND_ERR"),K.getDocument(a)!==c(this))return!1;var d=a.parentNode,e=K.getNodeIndex(a);x(d,"NOT_FOUND_ERR");var f=K.comparePoints(d,e,this.endContainer,this.endOffset),g=K.comparePoints(d,e+1,this.startContainer,this.startOffset);return b?0>=f&&g>=0:0>f&&g>0},isPointInRange:function(a,b){return A(this),x(a,"HIERARCHY_REQUEST_ERR"),v(a,this.startContainer),K.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&K.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){if(A(this),c(a)!=c(this))throw new M("WRONG_DOCUMENT_ERR");var d=K.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=K.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?0>=d&&e>=0:0>d&&e>0},intersection:function(a){if(this.intersectsRange(a)){var b=K.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),c=K.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();return-1==b&&d.setStart(a.startContainer,a.startOffset),1==c&&d.setEnd(a.endContainer,a.endOffset),d}return null},union:function(a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return-1==K.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&b.setStart(a.startContainer,a.startOffset),1==K.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&b.setEnd(a.endContainer,a.endOffset),b}throw new o("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==gb},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,K.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},createNodeIterator:function(a,b){return A(this),new p(this,a,b)},getNodes:function(a,b){return A(this),l(this,a,b)},getDocument:function(){return c(this)},collapseBefore:function(a){s(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){s(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return J.rangesEqual(this,a)},inspect:function(){return m(this)}},F(J,H,I),a.rangePrototype=B.prototype,J.rangeProperties=$,J.RangeIterator=n,J.copyComparisonConstants=D,J.createPrototypeRange=F,J.inspect=m,J.getRangeDocument=c,J.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},a.DomRange=J,a.RangeException=o}),rangy.createModule("WrappedRange",function(a){function b(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var d=c.parentElement();c=a.duplicate(),c.collapse(!1);var e=c.parentElement(),f=d==e?d:g.getCommonAncestor(d,e);return f==b?f:g.getCommonAncestor(b,f)}function c(a){return 0==a.compareEndPoints("StartToEnd",a)}function d(a,b,c,d){var e=a.duplicate();e.collapse(c);var f=e.parentElement();if(g.isAncestorOf(b,f,!0)||(f=b),!f.canHaveHTML)return new h(f.parentNode,g.getNodeIndex(f));var i,j,k,l,m,n=g.getDocument(f).createElement("span"),o=c?"StartToStart":"StartToEnd";do f.insertBefore(n,n.previousSibling),e.moveToElementText(n);while((i=e.compareEndPoints(o,a))>0&&n.previousSibling);if(m=n.nextSibling,-1==i&&m&&g.isCharacterDataNode(m)){e.setEndPoint(c?"EndToStart":"EndToEnd",a);var p;if(/[\r\n]/.test(m.data)){var q=e.duplicate(),r=q.text.replace(/\r\n/g,"\r").length;for(p=q.moveStart("character",r);-1==(i=q.compareEndPoints("StartToEnd",q));)p++,q.moveStart("character",1)}else p=e.text.length;l=new h(m,p)}else j=(d||!c)&&n.previousSibling,k=(d||c)&&n.nextSibling,l=k&&g.isCharacterDataNode(k)?new h(k,0):j&&g.isCharacterDataNode(j)?new h(j,j.length):new h(f,g.getNodeIndex(n));return n.parentNode.removeChild(n),l}function e(a,b){var c,d,e,f,h=a.offset,i=g.getDocument(a.node),j=i.body.createTextRange(),k=g.isCharacterDataNode(a.node);return k?(c=a.node,d=c.parentNode):(f=a.node.childNodes,c=h<f.length?f[h]:null,d=a.node),e=i.createElement("span"),e.innerHTML="&#feff;",c?d.insertBefore(e,c):d.appendChild(e),j.moveToElementText(e),j.collapse(!b),d.removeChild(e),k&&j[b?"moveStart":"moveEnd"]("character",h),j}a.requireModules(["DomUtil","DomRange"]);var f,g=a.dom,h=g.DomPosition,i=a.DomRange;if(!a.features.implementsDomRange||a.features.implementsTextRange&&a.config.preferTextRange){if(a.features.implementsTextRange){f=function(a){this.textRange=a,this.refresh()},f.prototype=new i(document),f.prototype.refresh=function(){var a,e,f=b(this.textRange);c(this.textRange)?e=a=d(this.textRange,f,!0,!0):(a=d(this.textRange,f,!0,!1),e=d(this.textRange,f,!1,!1)),this.setStart(a.node,a.offset),this.setEnd(e.node,e.offset)},i.copyComparisonConstants(f);var j=function(){return this}();"undefined"==typeof j.Range&&(j.Range=f),a.createNativeRange=function(a){return a=a||document,a.body.createTextRange()}}}else!function(){function b(a){for(var b,c=k.length;c--;)b=k[c],a[b]=a.nativeRange[b]}function c(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e;(f||g)&&(a.setEnd(d,e),a.setStart(b,c))}function d(a){a.nativeRange.detach(),a.detached=!0;for(var b,c=k.length;c--;)b=k[c],a[b]=null}var e,h,j,k=i.rangeProperties;f=function(a){if(!a)throw new Error("Range must be specified");this.nativeRange=a,b(this)},i.createPrototypeRange(f,c,d),e=f.prototype,e.selectNode=function(a){this.nativeRange.selectNode(a),b(this)},e.deleteContents=function(){this.nativeRange.deleteContents(),b(this)},e.extractContents=function(){var a=this.nativeRange.extractContents();return b(this),a},e.cloneContents=function(){return this.nativeRange.cloneContents()},e.surroundContents=function(a){this.nativeRange.surroundContents(a),b(this)},e.collapse=function(a){this.nativeRange.collapse(a),b(this)},e.cloneRange=function(){return new f(this.nativeRange.cloneRange())},e.refresh=function(){b(this)},e.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");g.getBody(document).appendChild(l);var m=document.createRange();m.setStart(l,0),m.setEnd(l,0);try{m.setStart(l,1),h=!0,e.setStart=function(a,c){this.nativeRange.setStart(a,c),b(this)},e.setEnd=function(a,c){this.nativeRange.setEnd(a,c),b(this)},j=function(a){return function(c){this.nativeRange[a](c),b(this)}}}catch(n){h=!1,e.setStart=function(a,c){try{this.nativeRange.setStart(a,c)}catch(d){this.nativeRange.setEnd(a,c),this.nativeRange.setStart(a,c)}b(this)},e.setEnd=function(a,c){try{this.nativeRange.setEnd(a,c)}catch(d){this.nativeRange.setStart(a,c),this.nativeRange.setEnd(a,c)}b(this)},j=function(a,c){return function(d){try{this.nativeRange[a](d)}catch(e){this.nativeRange[c](d),this.nativeRange[a](d)}b(this)}}}e.setStartBefore=j("setStartBefore","setEndBefore"),e.setStartAfter=j("setStartAfter","setEndAfter"),e.setEndBefore=j("setEndBefore","setStartBefore"),e.setEndAfter=j("setEndAfter","setStartAfter"),m.selectNodeContents(l),e.selectNodeContents=m.startContainer==l&&m.endContainer==l&&0==m.startOffset&&m.endOffset==l.length?function(a){this.nativeRange.selectNodeContents(a),b(this)}:function(a){this.setStart(a,0),this.setEnd(a,i.getEndOffset(a))},m.selectNodeContents(l),m.setEnd(l,3);var o=document.createRange();
o.selectNodeContents(l),o.setEnd(l,4),o.setStart(l,2),e.compareBoundaryPoints=-1==m.compareBoundaryPoints(m.START_TO_END,o)&1==m.compareBoundaryPoints(m.END_TO_START,o)?function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},a.util.isHostMethod(m,"createContextualFragment")&&(e.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),g.getBody(document).removeChild(l),m.detach(),o.detach()}(),a.createNativeRange=function(a){return a=a||document,a.createRange()};a.features.implementsTextRange&&(f.rangeToTextRange=function(a){if(a.collapsed){var b=e(new h(a.startContainer,a.startOffset),!0);return b}var c=e(new h(a.startContainer,a.startOffset),!0),d=e(new h(a.endContainer,a.endOffset),!1),f=g.getDocument(a.startContainer).body.createTextRange();return f.setEndPoint("StartToStart",c),f.setEndPoint("EndToEnd",d),f}),f.prototype.getName=function(){return"WrappedRange"},a.WrappedRange=f,a.createRange=function(b){return b=b||document,new f(a.createNativeRange(b))},a.createRangyRange=function(a){return a=a||document,new i(a)},a.createIframeRange=function(b){return a.createRange(g.getIframeDocument(b))},a.createIframeRangyRange=function(b){return a.createRangyRange(g.getIframeDocument(b))},a.addCreateMissingNativeApiListener(function(b){var c=b.document;"undefined"==typeof c.createRange&&(c.createRange=function(){return a.createRange(this)}),c=b=null})}),rangy.createModule("WrappedSelection",function(a,b){function c(a){return(a||window).getSelection()}function d(a){return(a||window).document.selection}function e(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function f(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function g(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function h(b){var c;return b instanceof y?(c=b._selectionNativeRange,c||(c=a.createNativeRange(w.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof z?c=b.nativeRange:a.features.implementsDomRange&&b instanceof w.getWindow(b.startContainer).Range&&(c=b),c}function i(a){if(!a.length||1!=a[0].nodeType)return!1;for(var b=1,c=a.length;c>b;++b)if(!w.isAncestorOf(a[0],a[b]))return!1;return!0}function j(a){var b=a.getNodes();if(!i(b))throw new Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function k(a){return!!a&&"undefined"!=typeof a.text}function l(a,b){var c=new z(b);a._ranges=[c],e(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function m(b){if(b._ranges.length=0,"None"==b.docSelection.type)g(b);else{var c=b.docSelection.createRange();if(k(c))l(b,c);else{b.rangeCount=c.length;for(var d,f=w.getDocument(c.item(0)),h=0;h<b.rangeCount;++h)d=a.createRange(f),d.selectNode(c.item(h)),b._ranges.push(d);b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed,e(b,b._ranges[b.rangeCount-1],!1)}}}function n(a,b){for(var c=a.docSelection.createRange(),d=j(b),e=w.getDocument(c.item(0)),f=w.getBody(e).createControlRange(),g=0,h=c.length;h>g;++g)f.add(c.item(g));try{f.add(d)}catch(i){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}f.select(),m(a)}function o(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function p(a,b){for(var c,d=w.getDocument(b[0].startContainer),e=w.getBody(d).createControlRange(),f=0;rangeCount>f;++f){c=j(b[f]);try{e.add(c)}catch(g){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}e.select(),m(a)}function q(a,b){if(a.anchorNode&&w.getDocument(a.anchorNode)!==w.getDocument(b))throw new A("WRONG_DOCUMENT_ERR")}function r(a){var b=[],c=new B(a.anchorNode,a.anchorOffset),d=new B(a.focusNode,a.focusOffset),e="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var f=0,g=a.rangeCount;g>f;++f)b[f]=y.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var s,t,u="boolean",v="_rangySelection",w=a.dom,x=a.util,y=a.DomRange,z=a.WrappedRange,A=a.DOMException,B=w.DomPosition,C="Control",D=a.util.isHostMethod(window,"getSelection"),E=a.util.isHostObject(document,"selection"),F=E&&(!D||a.config.preferTextRange);F?(s=d,a.isSelectionValid=function(a){var b=(a||window).document,c=b.selection;return"None"!=c.type||w.getDocument(c.createRange().parentElement())==b}):D?(s=c,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=s;var G=s(),H=a.createNativeRange(document),I=w.getBody(document),J=x.areHostObjects(G,["anchorNode","focusNode"]&&x.areHostProperties(G,["anchorOffset","focusOffset"]));a.features.selectionHasAnchorAndFocus=J;var K=x.isHostMethod(G,"extend");a.features.selectionHasExtend=K;var L="number"==typeof G.rangeCount;a.features.selectionHasRangeCount=L;var M=!1,N=!0;x.areHostMethods(G,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof G.rangeCount&&a.features.implementsDomRange&&!function(){var a=document.createElement("iframe");I.appendChild(a);var b=w.getIframeDocument(a);b.open(),b.write("<html><head></head><body>12</body></html>"),b.close();var c=w.getIframeWindow(a).getSelection(),d=b.documentElement,e=d.lastChild,f=e.firstChild,g=b.createRange();g.setStart(f,1),g.collapse(!0),c.addRange(g),N=1==c.rangeCount,c.removeAllRanges();var h=g.cloneRange();g.setStart(f,0),h.setEnd(f,2),c.addRange(g),c.addRange(h),M=2==c.rangeCount,g.detach(),h.detach(),I.removeChild(a)}(),a.features.selectionSupportsMultipleRanges=M,a.features.collapsedNonEditableSelectionsSupported=N;var O,P=!1;I&&x.isHostMethod(I,"createControlRange")&&(O=I.createControlRange(),x.areHostProperties(O,["item","add"])&&(P=!0)),a.features.implementsControlRange=P,t=J?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var Q;x.isHostMethod(G,"getRangeAt")?Q=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:J&&(Q=function(b){var c=w.getDocument(b.anchorNode),d=a.createRange(c);return d.setStart(b.anchorNode,b.anchorOffset),d.setEnd(b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&(d.setStart(b.focusNode,b.focusOffset),d.setEnd(b.anchorNode,b.anchorOffset)),d}),a.getSelection=function(a){a=a||window;var b=a[v],c=s(a),e=E?d(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new o(c,e,a),a[v]=b),b},a.getIframeSelection=function(b){return a.getSelection(w.getIframeWindow(b))};var R=o.prototype;if(!F&&J&&x.areHostMethods(G,["removeAllRanges","addRange"])){R.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),g(this)};var S=function(b,c){var d=y.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(h(e)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};R.addRange=L?function(b,c){if(P&&E&&this.docSelection.type==C)n(this,b);else if(c&&K)S(this,b);else{var d;if(M?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(h(b)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==d+1){if(a.config.checkSelectionRanges){var f=Q(this.nativeSelection,this.rangeCount-1);f&&!y.rangesEqual(f,b)&&(b=new z(f))}this._ranges[this.rangeCount-1]=b,e(this,b,V(this.nativeSelection)),this.isCollapsed=t(this)}else this.refresh()}}:function(a,b){b&&K?S(this,a):(this.nativeSelection.addRange(h(a)),this.refresh())},R.setRanges=function(a){if(P&&a.length>1)p(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;c>b;++b)this.addRange(a[b])}}}else{if(!(x.isHostMethod(G,"empty")&&x.isHostMethod(H,"select")&&P&&F))return b.fail("No means of selecting a Range or TextRange was found"),!1;R.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var a;if(this.anchorNode)a=w.getDocument(this.anchorNode);else if(this.docSelection.type==C){var b=this.docSelection.createRange();b.length&&(a=w.getDocument(b.item(0)).body.createTextRange())}if(a){var c=a.body.createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}g(this)},R.addRange=function(a){this.docSelection.type==C?n(this,a):(z.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,e(this,a,!1))},R.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?p(this,a):b&&this.addRange(a[0])}}R.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new A("INDEX_SIZE_ERR");return this._ranges[a]};var T;if(F)T=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=w.getBody(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==C?m(b):k(c)?l(b,c):g(b)};else if(x.isHostMethod(G,"getRangeAt")&&"number"==typeof G.rangeCount)T=function(b){if(P&&E&&b.docSelection.type==C)m(b);else if(b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount,b.rangeCount){for(var c=0,d=b.rangeCount;d>c;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));e(b,b._ranges[b.rangeCount-1],V(b.nativeSelection)),b.isCollapsed=t(b)}else g(b)};else{if(!J||typeof G.isCollapsed!=u||typeof H.collapsed!=u||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;T=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=Q(c,0),a._ranges=[b],a.rangeCount=1,f(a),a.isCollapsed=t(a)):g(a)}}R.refresh=function(a){var b=a?this._ranges.slice(0):null;if(T(this),a){var c=b.length;if(c!=this._ranges.length)return!1;for(;c--;)if(!y.rangesEqual(b[c],this._ranges[c]))return!1;return!0}};var U=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,f=c.length;f>e;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||g(a)};R.removeRange=P?function(a){if(this.docSelection.type==C){for(var b,c=this.docSelection.createRange(),d=j(a),e=w.getDocument(c.item(0)),f=w.getBody(e).createControlRange(),g=!1,h=0,i=c.length;i>h;++h)b=c.item(h),b!==d||g?f.add(c.item(h)):g=!0;f.select(),m(this)}else U(this,a)}:function(a){U(this,a)};var V;!F&&J&&a.features.implementsDomRange?(V=function(a){var b=!1;return a.anchorNode&&(b=1==w.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)),b},R.isBackwards=function(){return V(this)}):V=R.isBackwards=function(){return!1},R.toString=function(){for(var a=[],b=0,c=this.rangeCount;c>b;++b)a[b]=""+this._ranges[b];return a.join("")},R.collapse=function(b,c){q(this,b);var d=a.createRange(w.getDocument(b));d.collapseToPoint(b,c),this.removeAllRanges(),this.addRange(d),this.isCollapsed=!0},R.collapseToStart=function(){if(!this.rangeCount)throw new A("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},R.collapseToEnd=function(){if(!this.rangeCount)throw new A("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},R.selectAllChildren=function(b){q(this,b);var c=a.createRange(w.getDocument(b));c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},R.deleteFromDocument=function(){if(P&&E&&this.docSelection.type==C){for(var a,b=this.docSelection.createRange();b.length;)a=b.item(0),b.remove(a),a.parentNode.removeChild(a);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();this.removeAllRanges();for(var d=0,e=c.length;e>d;++d)c[d].deleteContents();this.addRange(c[e-1])}},R.getAllRanges=function(){return this._ranges.slice(0)},R.setSingleRange=function(a){this.setRanges([a])},R.containsNode=function(a,b){for(var c=0,d=this._ranges.length;d>c;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},R.toHtml=function(){var a="";if(this.rangeCount){for(var b=y.getRangeDocument(this._ranges[0]).createElement("div"),c=0,d=this._ranges.length;d>c;++c)b.appendChild(this._ranges[c].cloneContents());a=b.innerHTML}return a},R.getName=function(){return"WrappedSelection"},R.inspect=function(){return r(this)},R.detach=function(){this.win[v]=null,this.win=this.anchorNode=this.focusNode=null},o.inspect=r,a.Selection=o,a.selectionPrototype=R,a.addCreateMissingNativeApiListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return a.getSelection(this)}),b=null})}),rangy.createModule("SaveRestore",function(a,b){function c(a,b){return(b||document).getElementById(a)}function d(a,b){var c,d="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),e=k.getDocument(a.startContainer),f=a.cloneRange();return f.collapse(b),c=e.createElement("span"),c.id=d,c.style.lineHeight="0",c.style.display="none",c.className="rangySelectionBoundary",c.appendChild(e.createTextNode(l)),f.insertNode(c),f.detach(),c}function e(a,d,e,f){var g=c(e,a);g?(d[f?"setStartBefore":"setEndBefore"](g),g.parentNode.removeChild(g)):b.warn("Marker element has been removed. Cannot restore selection.")}function f(a,b){return b.compareBoundaryPoints(a.START_TO_START,a)}function g(e){e=e||window;var g=e.document;if(!a.isSelectionValid(e))return b.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),void 0;var h,i,j,k=a.getSelection(e),l=k.getAllRanges(),m=[];l.sort(f);for(var n=0,o=l.length;o>n;++n)j=l[n],j.collapsed?(i=d(j,!1),m.push({markerId:i.id,collapsed:!0})):(i=d(j,!1),h=d(j,!0),m[n]={startMarkerId:h.id,endMarkerId:i.id,collapsed:!1,backwards:1==l.length&&k.isBackwards()});for(n=o-1;n>=0;--n)j=l[n],j.collapsed?j.collapseBefore(c(m[n].markerId,g)):(j.setEndBefore(c(m[n].endMarkerId,g)),j.setStartAfter(c(m[n].startMarkerId,g)));return k.setRanges(l),{win:e,doc:g,rangeInfos:m,restored:!1}}function h(d,f){if(!d.restored){for(var g,h,i=d.rangeInfos,j=a.getSelection(d.win),k=[],l=i.length,m=l-1;m>=0;--m){if(g=i[m],h=a.createRange(d.doc),g.collapsed){var n=c(g.markerId,d.doc);if(n){n.style.display="inline";var o=n.previousSibling;o&&3==o.nodeType?(n.parentNode.removeChild(n),h.collapseToPoint(o,o.length)):(h.collapseBefore(n),n.parentNode.removeChild(n))}else b.warn("Marker element has been removed. Cannot restore selection.")}else e(d.doc,h,g.startMarkerId,!0),e(d.doc,h,g.endMarkerId,!1);1==l&&h.normalizeBoundaries(),k[m]=h}1==l&&f&&a.features.selectionHasExtend&&i[0].backwards?(j.removeAllRanges(),j.addRange(k[0],!0)):j.setRanges(k),d.restored=!0}}function i(a,b){var d=c(b,a);d&&d.parentNode.removeChild(d)}function j(a){for(var b,c=a.rangeInfos,d=0,e=c.length;e>d;++d)b=c[d],b.collapsed?i(a.doc,b.markerId):(i(a.doc,b.startMarkerId),i(a.doc,b.endMarkerId))}a.requireModules(["DomUtil","DomRange","WrappedRange"]);var k=a.dom,l="﻿";a.saveSelection=g,a.restoreSelection=h,a.removeMarkerElement=i,a.removeMarkers=j});