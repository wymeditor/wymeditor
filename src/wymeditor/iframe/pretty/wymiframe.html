<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
 * WYMeditor : what you see is What You Mean web-based editor
 * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/
 * Dual licensed under the MIT (MIT-license.txt)
 * and GPL (GPL-license.txt) licenses.
 *
 * For further information visit:
 *        http://www.wymeditor.org/
 *
 * File Name:
 *        wymiframe.html
 *        Iframe used by designMode.
 *        See the documentation for more info.
 *
 * File Authors:
 *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)
 *        Gyuris GellÃ©rt (bubu a-t ujevangelizacio dothu)
-->
<html xml:lang="en" lang="en">
<head>
<title>WYMeditor iframe</title>
<link rel="stylesheet" type="text/css" media="screen" href="wymiframe.css" />
<!--[if IE]><link rel="stylesheet" type="text/css" media="screen" href="wymiframe.ie.css" /><![endif]-->
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
	document.documentElement.addEventListener('DOMAttrModified', function(event) {
		if (event.target.tagName.toLowerCase() == 'html' && event.attrName == 'lang' && event.newValue != 'en') {
            var aRules=[], i, oCssRule, sKey, s = '', sLang = event.newValue;
			// get all rules with -> body:lang(en)
            for (i = 0; i < document.styleSheets[0].cssRules.length; i++) { 
				var oCssRule = document.styleSheets[0].cssRules[i];
				if (oCssRule.type == oCssRule.STYLE_RULE) {
					if (oCssRule.selectorText.match(/body:lang\(en\)/i)) {
						aRules.push(oCssRule.cssText)
					};
				};
			};
			// convert to string to simplify replace
			aRules.forEach(function(val) {
				s += val + '\n';
			});
			// replace lang() pseudo selector
			s = s.replace('body:lang(en)', 'body:lang('+sLang+')', 'gi');
			// replace db strings; only with lowercase! see 'g', not 'gi'
			// I suspect, we can guarantee, this is still loaded. Is it true?
			for (i in parent.WYMeditor.STRINGS[sLang]) {
				if (parent.WYMeditor.STRINGS[sLang].hasOwnProperty(i)) {
					s = s.replace(i, parent.WYMeditor.STRINGS[sLang][i], 'g');
				};
			};
			// convert back to array
			aRules = s.split('\n');
			aRules.pop(); // last \n
			// make CSS rules
			for (i = 0; i < aRules.length; i++) {
				document.styleSheets[0].insertRule(aRules[i], document.styleSheets[0].cssRules.length);
			};
		}
	}, false);
});
</script>
</head>
<body class="wym_iframe"></body>
</html>
